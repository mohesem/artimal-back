!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=10)}([function(e,t,n){"use strict";n.r(t),n.d(t,"db",(function(){return q})),n.d(t,"userCollection",(function(){return U})),n.d(t,"animalCollection",(function(){return M})),n.d(t,"logCollection",(function(){return j})),n.d(t,"weightCollection",(function(){return L})),n.d(t,"expensesCollection",(function(){return W})),n.d(t,"vaccineCollection",(function(){return B})),n.d(t,"fromAnimalToExpenses",(function(){return H})),n.d(t,"fromAnimalToWeight",(function(){return G})),n.d(t,"fromAnimalToAnimal",(function(){return K})),n.d(t,"fromVaccineToExpenses",(function(){return Y})),n.d(t,"fromAnimalToVaccine",(function(){return z}));var r=n(7),a=n(3);function o(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){o(s,r,a,u,c,"next",e)}function c(e){o(s,r,a,u,c,"throw",e)}u(void 0)}))}}var u=n.n(a)()("app:DB:createCollection");function c(e){return i.apply(this,arguments)}function i(){return(i=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("animals");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("animals collection already exists"):n.create().then((function(){u("animals Collection created")}),(function(e){throw new Error({msg:"Failed to create collection:",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return(f=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("users");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("users collection already exists"):n.create().then((function(){u("users collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return m.apply(this,arguments)}function m(){return(m=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("logs");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("logs collection already exists"):n.create().then((function(){u("logs collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return d.apply(this,arguments)}function d(){return(d=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("weights");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("weights collection already exists"):n.create().then((function(){u("weights collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("expenses");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("expenses collection already exists"):n.create().then((function(){u("expenses collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return g.apply(this,arguments)}function g(){return(g=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("vaccine");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("vaccine collection already exists"):n.create().then((function(){u("vaccine collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return R.apply(this,arguments)}function R(){return(R=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("disease");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("disease collection already exists"):n.create().then((function(){u("disease collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return T.apply(this,arguments)}function T(){return(T=s(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("fromAnimalToAnimal");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?u("animalAnimal edgeCollection already exists"):n.create().then((function(){u("animalAnimal edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return E.apply(this,arguments)}function E(){return(E=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("fromAnimalToWeight");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("animalWeights edgeCollection already exists"):n.create().then((function(){u("animalWeights edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e){return P.apply(this,arguments)}function P(){return(P=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("fromAnimalToExpenses");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("animalExpenses edgeCollection already exists"):n.create().then((function(){u("animalExpenses edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return _.apply(this,arguments)}function _(){return(_=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("fromVaccineToExpenses");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("vaccineExpenses edgeCollection already exists"):n.create().then((function(){u("vaccineExpenses edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return D.apply(this,arguments)}function D(){return(D=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("fromAnimalToVaccine");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("animalVaccine edgeCollection already exists"):n.create().then((function(){u("animalVaccine edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return I.apply(this,arguments)}function I(){return(I=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("fromAnimalToDisease");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?u("animalDisease edgeCollection already exists"):n.create().then((function(){u("animalDisease edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return S.apply(this,arguments)}function S(){return(S=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.arangoSearchView("animalView"),e.next=3,n.exists();case 3:e.sent?u("animalView laready exists"):n.create().then(s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("animalView created"),e.next=3,n.setProperties({links:{animals:{includeAllFields:!0}}});case 3:case"end":return e.stop()}}),e)}))),(function(e){throw new Error({msg:"Failed to create view",err:e})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V={host:"localhost",port:"8529",username:"artimal",password:"9KXgTVYmVTBuUuEvURUBBbnfhzwTp4Yc",database:"artimal"},q=new r.Database({url:"http://".concat(V.host,":").concat(V.port)});q.useBasicAuth(V.username,V.password),q.useDatabase(V.database),function(e){new Promise((function(t,n){try{s(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c(e);case 2:return n.next=4,l(e);case 4:return n.next=6,p(e);case 6:return n.next=8,h(e);case 8:return n.next=10,v(e);case 10:return n.next=12,x(e);case 12:return n.next=14,w(e);case 14:return n.next=16,k(e);case 16:return n.next=18,b(e);case 18:return n.next=20,A(e);case 20:return n.next=22,C(e);case 22:return n.next=24,O(e);case 24:return n.next=26,F(e);case 26:return n.next=28,N(e);case 28:t(!0);case 29:case"end":return n.stop()}}),n)})))()}catch(e){n(e)}}))}(q);var U=q.collection("users"),M=q.collection("animals"),j=q.collection("logs"),L=q.collection("weights"),W=q.collection("expenses"),B=q.collection("vaccine"),K=q.edgeCollection("fromAnimalToAnimal"),G=q.edgeCollection("fromAnimalToWeight"),H=q.edgeCollection("fromAnimalToExpenses"),Y=q.edgeCollection("fromVaccineToExpenses"),z=q.edgeCollection("fromAnimalToVaccine")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("arangojs")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t,n){"use strict";n.r(t);n(9);var r=n(1),a=n.n(r),o=n(5),s=n.n(o),u=n(4),c=n.n(u),i=n(6),l=n.n(i),f=n(3),p=n.n(f),m=n(0),h="testKey",d="testKey",v="توکن فرستاده شده اشتباه است",y="اشکال در درخواست فرستاده شده",x="اطلاعات مورد نظر یافت نشد",g=n(8),w=n.n(g),R=n(2),k=n.n(R);function T(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){T(o,r,a,s,u,"next",e)}function u(e){T(o,r,a,s,u,"throw",e)}s(void 0)}))}}function E(e){return A.apply(this,arguments)}function A(){return(A=b(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){m.db.query('FOR user IN users\n    FILTER user.username == "'.concat(t,'"\n    RETURN user')).then((function(t){var r=t._result;r.length?e(r[0]):n({status:401,error:"نام کاربری وارد شده اشتباه است"})})).catch((function(e){n({status:500,error:"خطای سرور"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return C.apply(this,arguments)}function C(){return(C=b(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){w.a.compare(n+h,t.password,(function(t,n){t&&r({status:500,error:"خطای سرور"}),n?e():r({status:401,error:"پسورد وارد شده اشتباه است"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return O.apply(this,arguments)}function O(){return(O=b(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){k.a.sign({key:t._key,username:t.username},d,(function(t,r){t?n({status:500,error:"خطای سرور"}):e(r)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}var F=function(e){var t=e.token;return new Promise(function(){var e,n=(e=regeneratorRuntime.mark((function e(n,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.verify(t,d);case 3:return a=e.sent,e.next=6,m.userCollection.document("users/".concat(a.key));case 6:if(o=e.sent,console.log("user is : ",o),o){e.next=10;break}throw new Error({status:400,error:v});case 10:o.username===a.username?n({status:200,msg:"ok"}):r({status:400,error:v}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 16:case"end":return e.stop()}}),e,null,[[0,13]])})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){D(o,r,a,s,u,"next",e)}function u(e){D(o,r,a,s,u,"throw",e)}s(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())},I=Object(r.Router)();I.post("/signin",(function(e,t){var n,r,a;(n=e.body,r=n.username,a=n.password,new Promise(function(){var e=b(regeneratorRuntime.mark((function e(t,n){var o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E(r);case 3:return o=e.sent,e.next=6,P(o,a);case 6:return e.next=8,_(o);case 8:s=e.sent,t({status:200,token:s}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({token:e.token})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),I.post("/verify",(function(e,t){F(e.body).then((function(e){return t.status(e.status).send({msg:e.msg})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var N=I;function S(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){S(o,r,a,s,u,"next",e)}function u(e){S(o,r,a,s,u,"throw",e)}s(void 0)}))}}var q=function(e){return new Promise(function(){var t=V(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.userCollection.document("users/".concat(e.key));case 2:(a=t.sent)||r({status:401,msg:"کاربری با این مشخصات یافت نشد"}),a.username!==e.username?r({status:401,msg:"کاربری با این مشخصات یافت نشد"}):n(a);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function U(e,t){return M.apply(this,arguments)}function M(){return(M=V(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(0===t.entryType)e({_key:t.key,entryDate:t.entryDate,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:t.entryDate});else if(1===t.entryType){e({_key:t.key,entryDate:t.entryDate,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:t.entryDate})}else if(2===t.entryType){e({_key:t.key,entryDate:t.entryDate,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:t.entryDate})}else n({status:400,error:y})})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function L(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){j(o,r,a,s,u,"next",e)}function u(e){j(o,r,a,s,u,"throw",e)}s(void 0)}))}}function W(e){return B.apply(this,arguments)}function B(){return(B=L(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){m.db.query(t).then((function(t){var n=t._result,r=n.map((function(e){return{key:e._key,type:e.type,race:e.race}}));n.length?(console.log(t._result),e(r)):e({results:[]})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=function(e,t,n,r){return new Promise((function(a,o){a('FOR animal IN animalView\n    SEARCH STARTS_WITH(animal._key, "'.concat(e,'")\n    ').concat(void 0!==t?"FILTER animal.sex == ".concat(t):"","\n    ").concat(n?'FILTER animal.type == "'.concat(n,'"'):"","\n    ").concat(r?"LIMIT ".concat(r):"","\n    RETURN animal")),o()}))};function G(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function H(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){G(o,r,a,s,u,"next",e)}function u(e){G(o,r,a,s,u,"throw",e)}s(void 0)}))}}function Y(e){return z.apply(this,arguments)}function z(){return(z=H(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.abrupt("return",new Promise(function(){var e=H(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.animalCollection.document("animals/".concat(t));case 3:a=e.sent,console.log(a),n(a),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return J.apply(this,arguments)}function J(){return(J=H(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){m.db.query('\n      FOR a IN animals\n      FILTER a._key == "'.concat(t,'"\n      FOR w IN 1..1 OUTBOUND a fromAnimalToWeight\n      SORT DATE_TIMESTAMP(w.createdAt) DESC\n      RETURN w\n      ')).then((function(t){var n=t._result,r=n.map((function(e){return{key:e._key,type:e.type,race:e.race}}));n.length?(console.log(t._result),e(r)):e({results:[]})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=Object(r.Router)();Q.put("/create",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=V(regeneratorRuntime.mark((function e(t,r){var a,o,s,u,c,i,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.verify(n.token,d);case 3:return a=e.sent,e.next=6,q(a);case 6:if(e.sent,0!==n.animal.entryType){e.next=22;break}return e.next=10,m.animalCollection.document("animals/".concat(n.animal.fatherkey));case 10:if(o=e.sent){e.next=13;break}throw new Error({status:400,error:y,printErrors:[{father:"دام نری با این پلاک برای این نوع حیوان وجود ندارد"}]});case 13:if(0===o.sex){e.next=15;break}throw new Error({status:400,error:y,printErrors:[{father:"عدم انطباق در جنسیت"}]});case 15:return e.next=17,m.animalCollection.document("animals/".concat(n.animal.motherKey));case 17:if(s=e.sent){e.next=20;break}throw new Error({status:400,error:y,printErrors:[{mother:"دام ماده ای با این پلاک برای این نوع حیوان وجود ندارد"}]});case 20:if(0===s.sex){e.next=22;break}throw new Error({status:400,error:y,printErrors:[{mother:"عدم انطباق در جنسیت"}]});case 22:return e.next=24,m.animalCollection.documentExists("".concat(n.animal.key));case 24:if(!0!==e.sent){e.next=27;break}throw new Error({status:401,error:"دامی با پلاک مشابه در دیتابیس ثبت شده است"});case 27:return e.next=29,U(n.animal,a);case 29:return u=e.sent,console.log(u),e.next=33,m.db.beginTransaction({write:["logs","animals","weights","fromAnimalToWeight","fromAnimalToAnimal","expenses","fromAnimalToExpenses"]});case 33:return c=e.sent,e.next=36,c.run((function(){return m.animalCollection.save(u)}));case 36:return i=e.sent,e.next=39,c.run((function(){return m.weightCollection.save({userkey:a.key,weight:n.animal.weight,createdAt:n.animal.entryDate})}));case 39:return l=e.sent,e.next=42,c.run((function(){return m.fromAnimalToWeight.save({_from:i._id,_to:l._id})}));case 42:if(0!==n.animal.entryType){e.next=51;break}return e.next=45,c.run((function(){return m.fromAnimalToAnimal.save({createdAt:n.animal.entryDate,type:"father",_from:i._id,_to:"animals/".concat(n.animal.fatherkey)})}));case 45:return e.next=47,c.run((function(){return m.fromAnimalToAnimal.save({createdAt:n.animal.entryDate,type:"mother",_from:i._id,_to:"animals/".concat(n.animal.motherkey)})}));case 47:return e.next=49,c.run((function(){return m.fromAnimalToAnimal.save({createdAt:n.animal.entryDate,type:"children",sex:n.animal.sex,_from:"animals/".concat(n.animal.fatherkey),_to:i._id})}));case 49:return e.next=51,c.run((function(){return m.fromAnimalToAnimal.save({createdAt:n.animal.entryDate,type:"children",sex:n.animal.sex,_from:"animals/".concat(n.animal.motherkey),_to:i._id})}));case 51:if(1!==n.animal.entryType){e.next=57;break}return e.next=54,c.run((function(){return m.expensesCollection.save({value:n.animal.price,createdAt:n.animal.entryDate,type:"buy-animal"})}));case 54:return f=e.sent,e.next=57,c.run((function(){return m.fromAnimalToExpenses.save({_from:i._id,_to:f._id})}));case 57:return e.next=59,c.commit();case 59:t({status:200,msg:"دام با موفقیت ایجاد شد"}),e.next=66;break;case 62:e.prev=62,e.t0=e.catch(0),console.log(e.t0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 66:case"end":return e.stop()}}),e,null,[[0,62]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({msg:e.msg})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Q.post("/read",(function(e,t){var n,r,a,o,s;(n=e.body,r=n.key,a=n.sex,o=n.type,s=n.limit,new Promise(function(){var e=L(regeneratorRuntime.mark((function e(t,n){var u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(r,a,o,s);case 2:return u=e.sent,console.log("........",u),e.prev=4,e.next=7,W(u);case 7:c=e.sent,console.log("..........",c),t({status:200,results:c}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),console.log(e.t0),n({status:500,msg:"خطای سرور"});case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({results:e.results})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Q.get("/detail/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=H(regeneratorRuntime.mark((function e(t,r){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y(n);case 3:return a=e.sent,e.next=6,X(n);case 6:o=e.sent,t({status:200,details:a,weights:o}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({details:e.details})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Q.get("/countTotal",(function(e,t){(e.body,new Promise((function(e,t){try{m.db.query("\n        FOR animal IN animals\n        FILTER !animal.death\n        FILTER !animal.sold\n        COLLECT WITH COUNT INTO length\n        RETURN length\n        ").then((function(t){var n=t._result;e({status:200,result:n})})).catch((function(e){throw new Error({status:500,error:"خطای سرور"})}))}catch(e){e.status?t(e):t({status:500,error:"خطای سرور"})}}))).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Z=Q;function $(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}var ee=function(){return new Promise(function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.animalCollection.count();case 2:(r=e.sent).error?n({status:500,error:"خطای سرور"}):(console.log(r.count),t({status:200,count:r.count+1}));case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){$(o,r,a,s,u,"next",e)}function u(e){$(o,r,a,s,u,"throw",e)}s(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())},te=Object(r.Router)();te.get("/new",(function(e,t){ee().then((function(e){return t.status(e.status).send({count:e.count})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var ne=te;function re(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function ae(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){re(o,r,a,s,u,"next",e)}function u(e){re(o,r,a,s,u,"throw",e)}s(void 0)}))}}var oe=function(e){return new Promise(function(){var t=ae(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.userCollection.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:"دامی با این پلاک وجود ندارد"});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function se(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function ue(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){se(o,r,a,s,u,"next",e)}function u(e){se(o,r,a,s,u,"throw",e)}s(void 0)}))}}function ce(e){return ie.apply(this,arguments)}function ie(){return(ie=ue(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){m.db.query(t).then((function(t){console.log("????????????",t);var r=t._result;r.length?e(r):n({status:404,error:x})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR weight IN 1..1 OUTBOUND animal fromAnimalToWeight\n    SORT DATE_TIMESTAMP(weight.createdAt) ASC\n    RETURN weight\n    ")),n()}))},fe=Object(r.Router)();fe.put("/create",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=ae(regeneratorRuntime.mark((function e(t,r){var a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.verify(n.token,d);case 3:return a=e.sent,e.next=6,oe(a);case 6:return e.next=8,m.animalCollection.documentExists("".concat(n.entry.key));case 8:return e.sent||r({status:400,error:"دامی با این پلاک یافت نشد"}),e.next=12,m.db.beginTransaction({write:["logs","animals","weights","fromAnimalToWeight"]});case 12:return o=e.sent,e.next=15,o.run((function(){return m.weightCollection.save({userkey:a.key,username:a.username,weight:"number"==typeof n.entry.weight?n.entry.weight:Number(n.entry.weight),createdAt:n.entry.date})}));case 15:return s=e.sent,e.next=18,o.run((function(){return m.logCollection.save({userkey:a.key,username:a.username,action:"PUT-weight",animalKey:n.entry.key,weightKey:s._key,createdAt:n.entry.date})}));case 18:return e.sent,e.next=21,o.run((function(){return m.fromAnimalToWeight.save({_from:"animals/".concat(n.entry.key),_to:s._id})}));case 21:return e.next=23,o.commit();case 23:t({status:200,result:"عملیات با موفقیت انجام شد"}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 30:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fe.post("/read",(function(e,t){var n,r;console.log("..............................."),(n=e.body,r=n.animalKeys,console.log("got the req, ".concat(r)),new Promise(function(){var e=ue(regeneratorRuntime.mark((function e(t,n){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.length){e.next=15;break}return e.prev=1,e.next=4,le(r[0]);case 4:return a=e.sent,console.log("query is",a),e.next=8,ce(a);case 8:o=e.sent,t({status:200,result:o}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var pe=fe;function me(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function he(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){me(o,r,a,s,u,"next",e)}function u(e){me(o,r,a,s,u,"throw",e)}s(void 0)}))}}function de(e){return ve.apply(this,arguments)}function ve(){return(ve=he(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){m.db.query(t).then((function(t){var r=t._result;r.length?e(r):n({status:404,error:x})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ye=function(e,t){return new Promise((function(n,r){n("FOR expense IN expenses\n    FILTER DATE_TIMESTAMP(expense.createdAt) >= DATE_TIMESTAMP('".concat(e,"') && DATE_TIMESTAMP(expense.createdAt) <= DATE_TIMESTAMP('").concat(t,"')\n    COLLECT AGGREGATE v = SUM(expense.value)\n    RETURN v")),r()}))},xe=Object(r.Router)();xe.get("/totalValue/:from/:to",(function(e,t){var n,r,a;console.log("+++++",{from:e.params.from,to:e.params.to}),(n={from:e.params.from,to:e.params.to},r=n.from,a=n.to,console.log("got the req, from : ".concat(r," , to : ").concat(a)),new Promise(function(){var e=he(regeneratorRuntime.mark((function e(t,n){var o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(r,a);case 2:return o=e.sent,console.log("........",o),e.prev=4,e.next=7,de(o);case 7:s=e.sent,console.log("..........",s),t({status:200,result:s}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),e.t0.status?n(e.t0):n({status:500,msg:"خطای سرور"});case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var ge=xe;function we(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function Re(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){we(o,r,a,s,u,"next",e)}function u(e){we(o,r,a,s,u,"throw",e)}s(void 0)}))}}var ke=function(e){return new Promise(function(){var t=Re(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.userCollection.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:v});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Te(e,t,n,r,a,o,s){try{var u=e[o](s),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){Te(o,r,a,s,u,"next",e)}function u(e){Te(o,r,a,s,u,"throw",e)}s(void 0)}))}}function Ee(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=be(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){m.db.query(t).then((function(t){console.log("????????????",t);var r=t._result;r.length?e(r):n({status:404,error:x})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pe=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR vaccine IN 1..1 OUTBOUND animal fromAnimalToVaccine\n    FOR expense IN 1..1 OUTBOUND vaccine fromVaccineToExpenses\n    SORT DATE_TIMESTAMP(vaccine.createdAt) ASC\n    RETURN {vaccine, expense}\n    ")),n()}))},Ce=Object(r.Router)();Ce.put("/create",(function(e,t){var n;console.log("%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%R"),(n=e.body,console.log(n),new Promise(function(){var e=Re(regeneratorRuntime.mark((function e(t,r){var a,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.verify(n.token,d);case 3:return a=e.sent,console.log(a),e.next=7,ke(a);case 7:return e.next=9,m.animalCollection.documentExists("".concat(n.entry.key));case 9:if(o=e.sent,console.log("****&&&^^^",o),o){e.next=13;break}throw new Error({status:400,error:"دامی با این پلاک یافت نشد"});case 13:return e.next=15,m.db.beginTransaction({write:["vaccine","animals","expenses","fromVaccineToExpenses","fromAnimalToVaccine"]});case 15:return s=e.sent,e.next=18,s.run((function(){return m.vaccineCollection.save({userkey:a.key,username:a.username,value:n.entry.vaccine[0],createdAt:n.entry.date})}));case 18:return u=e.sent,e.next=21,s.run((function(){return m.expensesCollection.save({value:n.entry.price,createdAt:n.entry.date,type:"vaccine"})}));case 21:return c=e.sent,e.next=24,s.run((function(){return m.fromAnimalToVaccine.save({createdAt:n.entry.date,_from:"animals/".concat(n.entry.key),_to:u._id})}));case 24:return e.next=26,s.run((function(){return m.fromVaccineToExpenses.save({_from:u._id,_to:c._id})}));case 26:return e.next=28,s.commit();case 28:t({status:200,result:"عملیات با موفقیت انجام شد"}),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 36:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Ce.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.keys,console.log("got the req, ".concat(r)),new Promise(function(){var e=be(regeneratorRuntime.mark((function e(t,n){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.length){e.next=15;break}return e.prev=1,e.next=4,Pe(r[0]);case 4:return a=e.sent,console.log("query is",a),e.next=8,Ee(a);case 8:o=e.sent,t({status:200,result:o}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var _e=Ce,Oe=Object(r.Router)();p()("routes:v0");Oe.use("/user",N),Oe.use("/animal",Z),Oe.use("/key",ne),Oe.use("/weight",pe),Oe.use("/expenses",ge),Oe.use("/vaccine",_e);var De={v0:Oe};n(0);var Fe=p()("app:server"),Ie=process.env.PORT||4e3,Ne=a()();Ne.use(l()()),Ne.use(c.a.urlencoded({extended:!1})),Ne.use(c.a.json()),Ne.use(s()()),Ne.use("/api/v0",De.v0),Ne.listen(Ie,(function(){return Fe("app listen to port ".concat(Ie))}))}]);