!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=10)}([function(e,t,n){"use strict";n.r(t),n.d(t,"db",(function(){return te})),n.d(t,"Users",(function(){return ne})),n.d(t,"Animals",(function(){return re})),n.d(t,"Logs",(function(){return se})),n.d(t,"Weights",(function(){return ae})),n.d(t,"Expenses",(function(){return ue})),n.d(t,"Vaccines",(function(){return oe})),n.d(t,"Incomes",(function(){return ce})),n.d(t,"Exits",(function(){return ie})),n.d(t,"Milks",(function(){return le})),n.d(t,"Pregnancies",(function(){return fe})),n.d(t,"Diseases",(function(){return de})),n.d(t,"DiseaseSteps",(function(){return pe})),n.d(t,"Errors",(function(){return me})),n.d(t,"UserEdges",(function(){return ve})),n.d(t,"AnimalEdges",(function(){return ge})),n.d(t,"WeightEdges",(function(){return ye})),n.d(t,"ExpenseEdges",(function(){return xe})),n.d(t,"VaccineEdges",(function(){return he})),n.d(t,"IncomeEdges",(function(){return we})),n.d(t,"ExitEdges",(function(){return Re})),n.d(t,"MilkEdges",(function(){return ke})),n.d(t,"PregnancyEdges",(function(){return be})),n.d(t,"DiseaseEdges",(function(){return Ee})),n.d(t,"LogEdges",(function(){return _e}));var r=n(5),s=n(3);function a(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var u=e.apply(t,n);function o(e){a(u,r,s,o,c,"next",e)}function c(e){a(u,r,s,o,c,"throw",e)}o(void 0)}))}}var o=n.n(s)()("app:DB:createCollection");function c(e){return i.apply(this,arguments)}function i(){return(i=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("animals");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("animals collection already exists"):n.create().then((function(){o("animals Collection created")}),(function(e){throw new Error({msg:"Failed to create collection:",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return(f=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("users");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("users collection already exists"):n.create().then((function(){o("users collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return(p=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("logs");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("logs collection already exists"):n.create().then((function(){o("logs collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("weights");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("weights collection already exists"):n.create().then((function(){o("weights collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("expenses");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("expenses collection already exists"):n.create().then((function(){o("expenses collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return h.apply(this,arguments)}function h(){return(h=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("vaccines");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("vaccines collection already exists"):n.create().then((function(){o("vaccines collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return R.apply(this,arguments)}function R(){return(R=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("diseases");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("disease collection already exists"):n.create().then((function(){o("disease collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("incomes");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("income collection already exists"):n.create().then((function(){o("income collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return _.apply(this,arguments)}function _(){return(_=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("exits");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("exits collection already exists"):n.create().then((function(){o("exits collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return T.apply(this,arguments)}function T(){return(T=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("milks");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("milks collection already exists"):n.create().then((function(){o("milks collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return A.apply(this,arguments)}function A(){return(A=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("pregnancies");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("pregnancies collection already exists"):n.create().then((function(){o("pregnancies collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return F.apply(this,arguments)}function F(){return(F=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("diseaseSteps");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("diseaseSteps collection already exists"):n.create().then((function(){o("diseaseSteps collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return N.apply(this,arguments)}function N(){return(N=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("animalEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("animalAnimal edgeCollection already exists"):n.create().then((function(){o("animalAnimal edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return U.apply(this,arguments)}function U(){return(U=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("userEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("user edgeCollection already exists"):n.create().then((function(){o("user edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return S.apply(this,arguments)}function S(){return(S=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("exitEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("exit edgeCollection already exists"):n.create().then((function(){o("exit edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return M.apply(this,arguments)}function M(){return(M=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("weightEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("weight edgeCollection already exists"):n.create().then((function(){o("weight edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return B.apply(this,arguments)}function B(){return(B=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("incomeEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("income edgeCollection already exists"):n.create().then((function(){o("income edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return V.apply(this,arguments)}function V(){return(V=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("expenseEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("expense edgeCollection already exists"):n.create().then((function(){o("expense edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return G.apply(this,arguments)}function G(){return(G=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("milkEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("milk edgeCollection already exists"):n.create().then((function(){o("milk edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return Y.apply(this,arguments)}function Y(){return(Y=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("diseaseEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("disease edgeCollection already exists"):n.create().then((function(){o("disease edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return X.apply(this,arguments)}function X(){return(X=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("pregnancyEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("pregnancy edgeCollection already exists"):n.create().then((function(){o("pregnancy edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return Q.apply(this,arguments)}function Q(){return(Q=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("vaccineEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("vaccine edgeCollection already exists"):n.create().then((function(){o("vaccine edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return $.apply(this,arguments)}function $(){return($=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.arangoSearchView("animalView"),e.next=3,n.exists();case 3:e.sent?o("animalView laready exists"):n.create().then(u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("animalView created"),e.next=3,n.setProperties({links:{animals:{includeAllFields:!0}}});case 3:case"end":return e.stop()}}),e)}))),(function(e){throw new Error({msg:"Failed to create view",err:e})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee={host:"localhost",port:"8529",username:"artimal",password:"9KXgTVYmVTBuUuEvURUBBbnfhzwTp4Yc",database:"artimal"},te=new r.Database({url:"http://".concat(ee.host,":").concat(ee.port)});te.useBasicAuth(ee.username,ee.password),te.useDatabase(ee.database),function(e){new Promise((function(t,n){try{u(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c(e);case 2:return n.next=4,l(e);case 4:return n.next=6,d(e);case 6:return n.next=8,m(e);case 8:return n.next=10,g(e);case 10:return n.next=12,x(e);case 12:return n.next=14,w(e);case 14:return n.next=16,D(e);case 16:return n.next=18,k(e);case 18:return n.next=20,E(e);case 20:return n.next=22,P(e);case 22:return n.next=24,I(e);case 24:return n.next=26,O(e);case 26:return n.next=28,C(e);case 28:return n.next=30,q(e);case 30:return n.next=32,j(e);case 32:return n.next=34,J(e);case 34:return n.next=36,H(e);case 36:return n.next=38,K(e);case 38:return n.next=40,L(e);case 40:return n.next=42,W(e);case 42:return n.next=44,z(e);case 44:return n.next=46,Z(e);case 46:t(!0);case 47:case"end":return n.stop()}}),n)})))()}catch(e){n(e)}}))}(te);var ne=te.collection("users"),re=te.collection("animals"),se=te.collection("logs"),ae=te.collection("weights"),ue=te.collection("expenses"),oe=te.collection("vaccines"),ce=te.collection("incomes"),ie=te.collection("exits"),le=te.collection("milks"),fe=te.collection("pregnancies"),de=te.collection("diseases"),pe=te.collection("diseaseSteps"),me=te.collection("errors"),ve=te.edgeCollection("userEdges"),ge=te.edgeCollection("animalEdges"),ye=te.edgeCollection("weightEdges"),xe=te.edgeCollection("expenseEdges"),he=te.edgeCollection("vaccineEdges"),we=te.edgeCollection("incomeEdges"),Re=te.edgeCollection("exitEdges"),ke=te.edgeCollection("milkEdges"),be=te.edgeCollection("pregnancyEdges"),Ee=te.edgeCollection("diseaseEdges"),_e=te.edgeCollection("logEdges")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("arangojs")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t,n){"use strict";n.r(t);n(9);var r=n(2),s=n.n(r),a=n(7),u=n.n(a),o=n(6),c=n.n(o),i=n(8),l=n.n(i),f=n(3),d=n.n(f),p=n(0),m="testKey",v=10,g="testKey",y="توکن فرستاده شده اشتباه است",x="اشکال در درخواست فرستاده شده",h="دامی با این پلاک یافت نشد",w="عملیات با موفقیت انجام شد",R="اطلاعات مورد نظر یافت نشد",k="شما اجازه ی انجام این عملیاتن را ندارید",b="امکان انجام این عملایات برایس دامی که از سیستم خارج شده است وجود ندارد",E=n(4),_=n.n(E),P=n(1),T=n.n(P);function I(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){I(a,r,s,u,o,"next",e)}function o(e){I(a,r,s,u,o,"throw",e)}u(void 0)}))}}function D(e){return F.apply(this,arguments)}function F(){return(F=A(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query('FOR user IN users\n    FILTER user.username == "'.concat(t,'"\n    RETURN user')).then((function(t){var r=t._result;r.length?e(r[0]):n({status:401,error:"نام کاربری وارد شده اشتباه است"})})).catch((function(e){n({status:500,error:"خطای سرور"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return N.apply(this,arguments)}function N(){return(N=A(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){_.a.compare(n+m,t.password,(function(t,n){t&&r({status:500,error:"خطای سرور"}),n?e():r({status:401,error:"پسورد وارد شده اشتباه است"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return U.apply(this,arguments)}function U(){return(U=A(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){T.a.sign({key:t._key,username:t.username},g,(function(t,r){t?n({status:500,error:"خطای سرور"}):e(r)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}var S=function(e){return new Promise(function(){var t,n=(t=regeneratorRuntime.mark((function t(n,r){var s,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.a.verify(e,g);case 3:return s=t.sent,t.next=6,p.Users.document("users/".concat(s.key));case 6:if(a=t.sent){t.next=9;break}throw new Error({status:400,error:y});case 9:a.username===s.username?n({status:200,result:{role:a.role}}):r({status:400,error:y}),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log("getUserByToken error ::: ",t.t0),t.t0.status?r(t.t0):r({status:500,error:"خطای سرور"});case 16:case"end":return t.stop()}}),t,null,[[0,12]])})),function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function u(e){L(a,r,s,u,o,"next",e)}function o(e){L(a,r,s,u,o,"throw",e)}u(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())};function q(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function M(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){q(a,r,s,u,o,"next",e)}function o(e){q(a,r,s,u,o,"throw",e)}u(void 0)}))}}var K=function(e){return new Promise(function(){var t=M(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},B=function(e){return new Promise((function(t,n){_.a.hash(e+m,v,function(){var e=M(regeneratorRuntime.mark((function e(r,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&n({error:"internal server error"}),t(s);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}))},j=Object(r.Router)();j.post("/login",(function(e,t){var n,r,s;(n=e.body,r=n.username,s=n.password,new Promise(function(){var e=A(regeneratorRuntime.mark((function e(t,n){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D(r);case 3:return a=e.sent,e.next=6,O(a,s);case 6:return e.next=8,C(a);case 8:u=e.sent,t({status:200,token:u}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("login error ::: ",e.t0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({token:e.token})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),j.get("/token/:token",(function(e,t){S(e.params.token).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),j.post("/",(function(e,t){var n;console.log("got the req",e.body),(n=e.body,console.log(n),new Promise(function(){var e=M(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log({decoded:s}),e.next=7,K(s);case 7:return a=e.sent,e.next=10,p.db.beginTransaction({read:["users"],write:["users","logs"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.db.query("\n        FOR user IN users\n          FILTER user.username == '".concat(n.entry.username,"'\n          RETURN user\n        "))}));case 13:if(!e.sent._result.length){e.next=16;break}throw{status:400,error:{username:"نام کاربری تکراری است"}};case 16:return e.next=18,B(n.entry.password);case 18:return o=e.sent,console.log({hash:o}),e.next=22,u.run((function(){return p.Users.save({username:n.entry.username,password:o,role:1===n.entry.role?"admin":"user"})}));case 22:return c=e.sent,e.next=25,u.run((function(){return p.Logs.save({value:"create",type:"user",entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 25:return console.log({newUser:c}),e.next=28,u.commit();case 28:t({status:200,result:w}),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 36:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var V=j;function W(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function G(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){W(a,r,s,u,o,"next",e)}function o(e){W(a,r,s,u,o,"throw",e)}u(void 0)}))}}var H=function(e){return new Promise(function(){var t=G(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document("users/".concat(e.key));case 2:(s=t.sent)||r({status:401,msg:"کاربری با این مشخصات یافت نشد"}),s.username!==e.username?r({status:401,msg:"کاربری با این مشخصات یافت نشد"}):n(s);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Y(e,t){return z.apply(this,arguments)}function z(){return(z=G(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("animal is :: ",t),e.abrupt("return",new Promise((function(e,n){if(t.weight||n({status:400,error:x}),console.log(!t.weight,2),t.type||n({status:400,error:x}),t.key||n({status:400,error:x}),t.entryDate||n({status:400,error:x}),t.birthDate||n({status:400,error:x}),"گاو"===t.type||t.race||n({status:400,error:x}),"number"!=typeof t.sex&&n({status:400,error:x}),"گوسفند"!==t.type||t.gene||n({status:400,error:x}),1!==t.entryType||t.price||n({status:400,error:x}),0!==t.entryType||t.fatherKey&&t.motherKey||n({status:400,error:x}),0===t.entryType)e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0});else if(1===t.entryType){e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0})}else if(2===t.entryType){var r={_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0,exit:!1};console.log(r),e(r)}else n({status:400,error:x})})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){J(a,r,s,u,o,"next",e)}function o(e){J(a,r,s,u,o,"throw",e)}u(void 0)}))}}function Z(e){return $.apply(this,arguments)}function $(){return($=Q(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result,r=n.map((function(e){return{key:e._key,type:e.type,race:e.race}}));n.length?(console.log(t._result),e(r)):e({result:[]})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=function(e,t,n,r,s){return console.log("___---___---_",X(r),r),new Promise((function(a,u){var o='FOR animal IN animalView\n    SEARCH STARTS_WITH(animal._key, "'.concat(t,'")\n    ').concat("_"!==n?"FILTER animal.sex == ".concat(n):"","\n    ").concat("_"!==r?'FILTER animal.type == "'.concat(r,'"'):"","\n    ").concat("_"!==s?'FILTER animal.entryType == "'.concat(s,'"'):"","\n    ").concat(e?"LIMIT ".concat(e):"","\n    RETURN animal");console.log(o),a(o),u()}))},te=function(e,t,n,r,s){return new Promise(function(){var a=Q(regeneratorRuntime.mark((function a(u,o){var c,i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,ee(e,t,n,r,s);case 2:return c=a.sent,a.prev=3,a.next=6,Z(c);case 6:i=a.sent,console.log("..........",i),u({status:200,result:i}),a.next=15;break;case 11:a.prev=11,a.t0=a.catch(3),console.log(a.t0),o({status:500,msg:"خطای سرور"});case 15:case"end":return a.stop()}}),a,null,[[3,11]])})));return function(e,t){return a.apply(this,arguments)}}())};function ne(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function re(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){ne(a,r,s,u,o,"next",e)}function o(e){ne(a,r,s,u,o,"throw",e)}u(void 0)}))}}function se(e){return ae.apply(this,arguments)}function ae(){return(ae=re(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.abrupt("return",new Promise(function(){var e=re(regeneratorRuntime.mark((function e(n,r){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Animals.document(t);case 3:s=e.sent,console.log(s),n(s),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}var oe=function(){return new Promise(function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.Animals.count();case 2:(r=e.sent).error?n({status:500,error:"خطای سرور"}):t({status:200,result:r.count+1});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){ue(a,r,s,u,o,"next",e)}function o(e){ue(a,r,s,u,o,"throw",e)}u(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())};function ce(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){ce(a,r,s,u,o,"next",e)}function o(e){ce(a,r,s,u,o,"throw",e)}u(void 0)}))}}function le(e){return fe.apply(this,arguments)}function fe(){return(fe=ie(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("::::::::::",t),e.abrupt("return",new Promise(function(){var e=ie(regeneratorRuntime.mark((function e(n,r){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.db.query("\n        FOR pregnancy, edge IN OUTBOUND 'animals/".concat(t,"' animalEdges\n        FILTER edge.value == 'pregnancy'\n        FOR animal IN INBOUND pregnancy._id animalEdges\n        FILTER animal.sex == 0\n        SORT DATE_TIMESTAMP(pregnancy.startedAt) DESC\n        RETURN {pregnancy, male: animal}\n        "));case 3:s=e.sent,console.log(s._result),n(s._result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function pe(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){de(a,r,s,u,o,"next",e)}function o(e){de(a,r,s,u,o,"throw",e)}u(void 0)}))}}function me(e){return ve.apply(this,arguments)}function ve(){return(ve=pe(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=pe(regeneratorRuntime.mark((function e(n,r){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.db.query("\n        FOR vaccine, edge IN OUTBOUND 'animals/".concat(t,"' animalEdges\n        FILTER edge.value == 'vaccine'\n        Filter vaccine.deleted != true\n        return vaccine\n        "));case 3:s=e.sent,console.log(s._result),n(s._result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ge=Object(r.Router)();ge.get("/newKey",(function(e,t){oe().then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.get("/stock/:limit/:animalKey/:sex/:type/:race",(function(e,t){te(e.params.limit,e.params.animalKey,e.params.sex,e.params.type,e.params.race).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.get("/stock/:limit/:animalKey/:sex?/:type?/:entryType?",(function(e,t){console.log("sex is :::: ",e.params.sex),te(e.params.limit,e.params.animalKey,e.params.sex,e.params.type,e.params.entryType).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.get("/detail/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=re(regeneratorRuntime.mark((function e(t,r){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,se(n);case 3:s=e.sent,t({status:200,details:s}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({details:e.details})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.get("/pregnancy/:key",(function(e,t){var n;console.log("ppppppppppppppppppppppp"),(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=ie(regeneratorRuntime.mark((function e(t,r){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,le(n);case 3:s=e.sent,console.log("result is :: ",s),t({status:200,result:s}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.post("/new",(function(e,t){var n;(n=e.body,console.log("...............................................",n),new Promise(function(){var e=G(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,e.next=6,H(s);case 6:return a=e.sent,e.next=9,p.Animals.documentExists("".concat(n.animal.key));case 9:if(!0!==e.sent){e.next=12;break}throw{status:401,error:"دامی با پلاک مشابه در دیتابیس ثبت شده است"};case 12:return e.next=14,Y(n.animal,s);case 14:return u=e.sent,e.next=17,p.db.beginTransaction({write:["logs","animals","weights","expenses","animalEdges"]});case 17:return o=e.sent,e.next=20,o.run((function(){return p.Animals.save(u)}));case 20:return c=e.sent,e.next=23,o.run((function(){return p.Weights.save({value:"number"==typeof n.animal.weight?n.animal.weight:Number(n.animal.weight),createdAt:Date.now(),date:n.animal.entryDate})}));case 23:return i=e.sent,e.next=26,o.run((function(){return p.AnimalEdges.save({value:"weight",_from:c._id,_to:i._id})}));case 26:return e.next=28,o.run((function(){return p.Logs.save({value:"create",type:"animal",entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 28:return e.next=30,o.run((function(){return p.Logs.save({value:"create",type:"weight",entryId:i._id,userId:a._id,createdAt:Date.now()})}));case 30:if(1!==n.animal.entryType){e.next=38;break}return e.next=33,o.run((function(){return p.Expenses.save({value:"number"==typeof n.animal.price?n.animal.price:Number(n.animal.price),createdAt:Date.now(),date:n.animal.entryDate,type:"buy-animal"})}));case 33:return l=e.sent,e.next=36,o.run((function(){return p.AnimalEdges.save({value:"expense",_from:c._id,_to:l._id})}));case 36:return e.next=38,o.run((function(){return p.Logs.save({value:"create",type:"expense",entryId:l._id,userId:a._id,createdAt:Date.now()})}));case 38:return e.next=40,o.commit();case 40:t({status:200,result:"دام با موفقیت ایجاد شد"}),e.next=47;break;case 43:e.prev=43,e.t0=e.catch(0),console.log(e.t0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 47:case"end":return e.stop()}}),e,null,[[0,43]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.get("/vaccine/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=pe(regeneratorRuntime.mark((function e(t,r){var s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me(n);case 3:s=e.sent,console.log("result is :: ",s),t({status:200,result:s}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),ge.get("/total",(function(e,t){new Promise((function(e,t){try{p.db.query("\n        FOR animal IN animals\n        FILTER animal.deleted != true\n        FILTER animal.exit != true\n        COLLECT WITH COUNT INTO length\n        RETURN length\n        ").then((function(t){var n=t._result;e({status:200,result:n})})).catch((function(e){throw new Error({status:500,error:"خطای سرور"})}))}catch(e){e.status?t(e):t({status:500,error:"خطای سرور"})}})).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var ye=ge;function xe(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}var he=function(e,t){return new Promise(function(){var n,r=(n=regeneratorRuntime.mark((function n(r,s){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{p.db.query("\n        FOR log IN logs\n        SORT DATE_TIMESTAMP(log.createdAt) DESC\n        LIMIT ".concat(Number(t)*Number(e),", ").concat(Number(t+1)*Number(e),"\n        return log\n        ")).then((function(e){console.log(e._result),r({status:200,result:e._result})}))}catch(e){console.log(e),s({status:500,msg:"خطای سرور"})}case 1:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,s){var a=n.apply(e,t);function u(e){xe(a,r,s,u,o,"next",e)}function o(e){xe(a,r,s,u,o,"throw",e)}u(void 0)}))});return function(e,t){return r.apply(this,arguments)}}())},we=Object(r.Router)();we.get("/pagination/:limit/:page",(function(e,t){he(e.params.limit,e.params.page).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Re=we;function ke(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){ke(a,r,s,u,o,"next",e)}function o(e){ke(a,r,s,u,o,"throw",e)}u(void 0)}))}}var Ee=function(e){return new Promise(function(){var t=be(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:"دامی با این پلاک وجود ندارد"});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function _e(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Pe(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){_e(a,r,s,u,o,"next",e)}function o(e){_e(a,r,s,u,o,"throw",e)}u(void 0)}))}}function Te(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=Pe(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ae=function(e){return new Promise((function(t,n){t("\n    FOR weight, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'weight'\n    FILTER weight.deleted != true\n    RETURN weight\n    ")),n()}))};function De(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Fe(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){De(a,r,s,u,o,"next",e)}function o(e){De(a,r,s,u,o,"throw",e)}u(void 0)}))}}var Oe=function(e){return new Promise(function(){var t=Fe(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Ne(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Ce(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Ne(a,r,s,u,o,"next",e)}function o(e){Ne(a,r,s,u,o,"throw",e)}u(void 0)}))}}var Ue=function(e){return new Promise(function(){var t=Ce(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},Le=Object(r.Router)();Le.get("/:animalKey",(function(e,t){var n;(n=e.params.animalKey,new Promise(function(){var e=Pe(regeneratorRuntime.mark((function e(t,r){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ae(n);case 3:return s=e.sent,e.next=6,Te(s);case 6:a=e.sent,t({status:200,result:a}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Le.post("/new",(function(e,t){var n;(n=e.body,console.log("================================",n),new Promise(function(){var e=be(regeneratorRuntime.mark((function e(t,r){var s,a,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,e.next=6,Ee(s);case 6:return a=e.sent,e.next=9,p.Animals.documentExists("".concat(n.entry.key));case 9:return e.sent||r({status:400,error:h}),e.next=13,p.Animals.document(n.entry.key);case 13:if(!0!==e.sent.out){e.next=16;break}throw{status:401,error:animalIsOut};case 16:return e.next=18,p.db.beginTransaction({write:["logs","animals","weights","animalEdges"]});case 18:return u=e.sent,e.next=21,u.run((function(){return p.Weights.save({value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),createdAt:Date.now(),date:n.entry.date})}));case 21:return o=e.sent,e.next=24,u.run((function(){return p.AnimalEdges.save({value:"weight",_from:"animals/".concat(n.entry.key),_to:o._id})}));case 24:return e.next=26,u.run((function(){return p.Logs.save({value:"create",type:"weight",entryId:o._id,userId:a._id,createdAt:Date.now()})}));case 26:return e.next=28,u.commit();case 28:t({status:200,result:w}),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 36:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Le.delete("/:token/:key",(function(e,t){var n,r;console.log("reeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeemove"),(n=e.params.token,r=e.params.key,new Promise(function(){var e=Fe(regeneratorRuntime.mark((function e(t,s){var a,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return a=e.sent,console.log(a),e.next=7,Oe(a);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({read:["weights"],write:["logs","weights"]});case 10:return o=e.sent,e.next=13,o.run((function(){return p.Weights.document(r)}));case 13:return c=e.sent,e.next=16,o.run((function(){return p.Weights.update(c,{deleted:!0,deleteDate:Date.now()})}));case 16:return e.next=18,o.run((function(){return p.Logs.save({value:"delete",type:"weight",entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 18:return e.next=20,o.commit();case 20:t({status:200,result:w}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&s(e.t0),s({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Le.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=Ce(regeneratorRuntime.mark((function e(t,r){var s,a,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log(s),e.next=7,Ue(s);case 7:return a=e.sent,e.next=10,p.db.beginTransaction({write:["logs","weights"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.Weights.document(n.entry.key)}));case 13:return o=e.sent,console.log("weight is :: ",o),e.next=17,u.run((function(){return p.Logs.save({value:"update",type:"weight",entryId:o._id,userId:a._id,form:{date:o.date,value:o.value},to:{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date},createdAt:Date.now()})}));case 17:return e.next=19,u.run((function(){return p.Weights.update(o,{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date,updatedAt:n.entry.updatedAt})}));case 19:return e.next=21,u.commit();case 21:t({status:200,result:w}),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 29:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Se=Le;function qe(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Me(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){qe(a,r,s,u,o,"next",e)}function o(e){qe(a,r,s,u,o,"throw",e)}u(void 0)}))}}function Ke(e){return Be.apply(this,arguments)}function Be(){return(Be=Me(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;r.length?e(r):n({status:404,error:R})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=function(e,t){return new Promise((function(n,r){n("FOR expense IN expenses\n    FILTER expense.deleted != true\n    FILTER DATE_TIMESTAMP(expense.createdAt) >= DATE_TIMESTAMP('".concat(e,"') && DATE_TIMESTAMP(expense.createdAt) <= DATE_TIMESTAMP('").concat(t,"')\n    COLLECT AGGREGATE v = SUM(expense.value)\n    RETURN v")),r()}))},Ve=Object(r.Router)();Ve.get("/:from/:to",(function(e,t){var n,r;(n=e.params.from,r=e.params.to,new Promise(function(){var e=Me(regeneratorRuntime.mark((function e(t,s){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je(n,r);case 2:return a=e.sent,console.log("........",a),e.prev=4,e.next=7,Ke(a);case 7:u=e.sent,console.log("..........",u),t({status:200,result:u}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),e.t0.status?s(e.t0):s({status:500,msg:"خطای سرور"});case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var We=Ve;function Ge(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function He(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Ge(a,r,s,u,o,"next",e)}function o(e){Ge(a,r,s,u,o,"throw",e)}u(void 0)}))}}var Ye=function(e){return new Promise(function(){var t=He(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function ze(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Xe(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){ze(a,r,s,u,o,"next",e)}function o(e){ze(a,r,s,u,o,"throw",e)}u(void 0)}))}}function Je(e){return Qe.apply(this,arguments)}function Qe(){return(Qe=Xe(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ze=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR vaccine IN 1..1 OUTBOUND animal fromAnimalToVaccine\n    FILTER vaccine.deleted != true\n    SORT DATE_TIMESTAMP(vaccine.createdAt) ASC\n    RETURN {vaccine}\n    ")),n()}))};function $e(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function et(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){$e(a,r,s,u,o,"next",e)}function o(e){$e(a,r,s,u,o,"throw",e)}u(void 0)}))}}var tt=function(e){return new Promise(function(){var t=et(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function nt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function rt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){nt(a,r,s,u,o,"next",e)}function o(e){nt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var st=function(e){return new Promise(function(){var t=rt(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},at=Object(r.Router)();at.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.keys,console.log("got the req, ".concat(r)),new Promise(function(){var e=Xe(regeneratorRuntime.mark((function e(t,n){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.length){e.next=14;break}return e.prev=1,e.next=4,Ze(r[0]);case 4:return s=e.sent,e.next=7,Je(s);case 7:a=e.sent,t({status:200,result:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),at.post("/",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=He(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log(s),e.next=7,Ye(s);case 7:return a=e.sent,e.next=10,p.Animals.documentExists("".concat(n.entry.key));case 10:if(u=e.sent,console.log("****&&&^^^",u),u){e.next=14;break}throw{status:400,error:h};case 14:return e.next=16,p.db.beginTransaction({read:["animals"],write:["vaccines","animals","animalEdges","logs"]});case 16:return o=e.sent,e.next=19,p.Animals.document(n.entry.key);case 19:if(!0!==(c=e.sent).out){e.next=22;break}throw{status:401,error:b};case 22:return console.log("animal is ::: ",c),e.next=25,o.run((function(){return p.Vaccines.save({value:n.entry.vaccine,date:n.entry.date,createdAt:Date.now()})}));case 25:return i=e.sent,e.next=28,o.run((function(){return p.AnimalEdges.save({value:"vaccine",_from:c._id,_to:i._id})}));case 28:return e.next=30,o.run((function(){return p.Logs.save({value:"create",type:"vaccine",entryId:i._id,userId:a._id,createdAt:Date.now()})}));case 30:return e.next=32,o.commit();case 32:t({status:200,result:w}),e.next=40;break;case 35:e.prev=35,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 40:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),at.delete("/:token/:key",(function(e,t){var n,r;(n=e.params.token,r=e.params.key,new Promise(function(){var e=et(regeneratorRuntime.mark((function e(t,s){var a,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return a=e.sent,console.log(a),e.next=7,tt(a);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({write:["animals","logs","vaccines"]});case 10:return o=e.sent,e.next=13,o.run((function(){return p.Vaccines.document(r)}));case 13:return c=e.sent,e.next=16,o.run((function(){return p.Vaccines.update(c,{deleted:!0})}));case 16:return e.next=18,o.run((function(){return p.Logs.save({value:"delete",type:"vaccine",entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 18:return e.next=20,o.commit();case 20:t({status:200,result:w}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&s(e.t0),s({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),at.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=rt(regeneratorRuntime.mark((function e(t,r){var s,a,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log(s),e.next=7,st(s);case 7:return a=e.sent,e.next=10,p.db.beginTransaction({write:["logs","vaccines"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.Vaccines.document(n.entry.key)}));case 13:return o=e.sent,e.next=16,u.run((function(){return p.Logs.save({value:"update",type:"vaccine",entryId:o._id,userId:a._id,form:{date:o.date,value:o.value,updatedAt:o.updatedAt},to:{value:n.entry.value,date:n.entry.date,updatedAt:n.entry.updatedAt},createdAt:Date.now()})}));case 16:return e.next=18,u.run((function(){return p.Vaccines.update(o,{value:n.entry.value,date:n.entry.date,updatedAt:n.entry.updatedAt})}));case 18:return e.next=20,u.commit();case 20:t({status:200,result:w}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var ut=at;n(5);function ot(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function ct(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){ot(a,r,s,u,o,"next",e)}function o(e){ot(a,r,s,u,o,"throw",e)}u(void 0)}))}}var it=function(e){return new Promise(function(){var t=ct(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function lt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function ft(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){lt(a,r,s,u,o,"next",e)}function o(e){lt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var dt=function(e){return new Promise(function(){var t=ft(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function pt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function mt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){pt(a,r,s,u,o,"next",e)}function o(e){pt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var vt=function(e){return new Promise(function(){var t=mt(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function gt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function yt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){gt(a,r,s,u,o,"next",e)}function o(e){gt(a,r,s,u,o,"throw",e)}u(void 0)}))}}function xt(e){return ht.apply(this,arguments)}function ht(){return(ht=yt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;e(r),n()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wt=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'exit'\n    Filter vertex.deleted != true\n    return vertex\n    ")),n()}))},Rt=Object(r.Router)();Rt.get("/:animalKey",(function(e,t){var n;(n=e.params.animalKey,new Promise(function(){var e=yt(regeneratorRuntime.mark((function e(t,r){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wt(n);case 3:return s=e.sent,e.next=6,xt(s);case 6:a=e.sent,console.log("result is ::: ",a),t({status:200,result:a[0]}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Rt.post("/sell",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=ft(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,e.next=6,dt(s);case 6:return a=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["animals","exits","incomes","animalEdges","logs"]});case 9:return u=e.sent,e.next=12,u.run((function(){return p.Animals.document(n.entry.key)}));case 12:if(!(o=e.sent).exit){e.next=15;break}throw{status:400,error:"امکان ثبت فروش برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 15:return e.next=17,u.run((function(){return p.Animals.update(o,{exit:!0})}));case 17:return e.next=19,u.run((function(){return p.Exits.save({type:"sell",date:n.entry.date,comment:n.entry.comment,createdAt:Date.now()})}));case 19:return c=e.sent,e.next=22,u.run((function(){return p.Incomes.save({type:"sell",date:n.entry.date,price:"number"==typeof n.entry.price?n.entry.price:Number(n.entry.price),createdAt:Date.now()})}));case 22:return i=e.sent,e.next=25,u.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:i._id})}));case 25:return e.next=27,u.run((function(){return p.AnimalEdges.save({value:"income",_from:o._id,_to:c._id})}));case 27:return e.next=29,u.run((function(){return p.Logs.save({value:"create",type:"exit",entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 29:return e.next=31,u.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 31:return e.next=33,u.run((function(){return p.Logs.save({value:"create",type:"income",entryId:i._id,userId:a._id,createdAt:Date.now()})}));case 33:return e.next=35,u.commit();case 35:t({status:200,result:w}),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 43:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Rt.post("/slaughter",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=mt(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,e.next=6,vt(s);case 6:return a=e.sent,e.next=9,p.db.beginTransaction({write:["animals","exits","animalEdges","weights","logs"]});case 9:return u=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!(o=e.sent).exit){e.next=16;break}throw console.log("animal is out"),{status:400,error:"امکان ثبت ذبح برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 16:return e.next=18,u.run((function(){return p.Animals.update(o,{exit:!0})}));case 18:return e.next=20,u.run((function(){return p.Exits.save({type:"slaughter",date:n.entry.date,createdAt:Date.now()})}));case 20:return c=e.sent,e.next=23,u.run((function(){return p.Weights.save({value:"number"==typeof n.entry.weight?n.entry.weight:Number(n.entry.weight),createdAt:Date.now(),date:n.entry.date})}));case 23:return i=e.sent,e.next=26,u.run((function(){return p.AnimalEdges.save({value:"weight",_from:o._id,_to:i._id})}));case 26:return e.next=28,u.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:c._id})}));case 28:return e.next=30,u.run((function(){return p.Logs.save({value:"create",type:"exit",entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 30:return e.next=32,u.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 32:return e.next=34,u.run((function(){return p.Logs.save({value:"create",type:"weight",entryId:i._id,userId:a._id,createdAt:Date.now()})}));case 34:return e.next=36,u.commit();case 36:t({status:200,result:w}),e.next=44;break;case 39:e.prev=39,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 44:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({msg:e.msg})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Rt.post("/death",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=ct(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,e.next=6,it(s);case 6:return a=e.sent,e.next=9,p.db.beginTransaction({write:["animals","exits","animalEdges","diseases","diseaseSteps","exitEdges","diseaseEdges","logs"]});case 9:return u=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!(o=e.sent).out){e.next=16;break}throw console.log("**************"),{status:400,error:"امکان ثبت مرگ برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 16:return e.next=18,u.run((function(){return p.Animals.update(o,{exit:!0})}));case 18:return e.next=20,u.run((function(){return p.Exits.save({type:"death",reason:n.entry.reason,disease:"بیماری"===n.entry.reason?n.entry.disease.value:void 0,date:n.entry.date,createdAt:Date.now(),comment:n.entry.comment})}));case 20:return c=e.sent,e.next=23,u.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:c._id})}));case 23:return e.next=25,u.run((function(){return p.db.query("\n          FOR vertex, edge IN OUTBOUND 'animals/".concat(n.entry.key,"' animalEdges\n          FILTER edge.value == 'disease'\n          FILTER vertex.deleted != true\n          FILTER vertex.active == true\n          RETURN vertex\n          "))}));case 25:return e.sent._result.forEach(function(){var e=ct(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.run((function(){return p.Diseases.update(t,{active:!1})}));case 2:return e.next=4,u.run((function(){return p.Logs.save({value:"update",type:"disease",from:{active:!0},to:{active:!1},entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=29,u.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 29:return e.next=31,u.run((function(){return p.Logs.save({value:"create",type:"exit",entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 31:if("بیماری"!==n.entry.reason){e.next=40;break}return console.log("##############################################################"),e.next=35,u.run((function(){return p.DiseaseSteps.save({drugs:n.entry.drugs,effects:n.entry.effects,treatment:n.entry.treatment,comment:n.entry.comment,isCured:n.entry.isCured,date:n.entry.date,createdAt:Date.now(),died:!0})}));case 35:return i=e.sent,e.next=38,u.run((function(){return p.DiseaseEdges.save({value:"step",_from:n.entry.disease._id,_to:i._id})}));case 38:return e.next=40,u.run((function(){return p.ExitEdges.save({value:"disease",_from:c._id,_to:n.entry.disease._id})}));case 40:return e.next=42,u.commit();case 42:t({status:200,result:w}),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 50:case"end":return e.stop()}}),e,null,[[0,45]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var kt=Rt;function bt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Et(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){bt(a,r,s,u,o,"next",e)}function o(e){bt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var _t=function(e){return new Promise(function(){var t=Et(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Pt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Tt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Pt(a,r,s,u,o,"next",e)}function o(e){Pt(a,r,s,u,o,"throw",e)}u(void 0)}))}}function It(e){return At.apply(this,arguments)}function At(){return(At=Tt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;e(r),n()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Dt=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR pregnancy IN 1..1 OUTBOUND animal fromAnimalToPregnancy\n    FOR male IN 1..1 INBOUND pregnancy fromAnimalToPregnancy\n    FILTER pregnancy.deleted == false\n    FILTER male.sex == 0\n    SORT DATE_TIMESTAMP(pregnancy.startedAt) ASC\n    RETURN {pregnancy, male}\n    ")),n()}))};function Ft(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Ot(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Ft(a,r,s,u,o,"next",e)}function o(e){Ft(a,r,s,u,o,"throw",e)}u(void 0)}))}}function Nt(e){return Ct.apply(this,arguments)}function Ct(){return(Ct=Ot(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){console.log("***************",t);var r=t._result;r.length?e(r):n({status:404,error:R})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ut=function(e){return new Promise((function(t,n){t("\n    FOR edge IN pregnancy\n    FILTER edge._key == '".concat(e,"'\n    FOR parent IN 1..1 INBOUND edge fromAnimalToPregnancy\n    RETURN {parent}\n    ")),n()}))};function Lt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function St(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Lt(a,r,s,u,o,"next",e)}function o(e){Lt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var qt=function(e){return new Promise(function(){var t=St(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.userCollection.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},Mt=Object(r.Router)();Mt.post("/new",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=Et(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log(s),e.next=7,_t(s);case 7:return a=e.sent,e.next=10,p.Animals.documentExists(n.entry.maleKey);case 10:if(e.sent){e.next=13;break}throw{status:400,error:h};case 13:return e.next=15,p.Animals.documentExists(n.entry.femaleKey);case 15:if(e.sent){e.next=18;break}throw{status:400,error:h};case 18:return e.next=20,p.db.beginTransaction({read:["animals"],write:["animals","logs","pregnancies","animalEdges"]});case 20:return u=e.sent,o={startedAt:n.entry.date,createdAt:Date.now(),active:!0},n.entry.note&&(o.notes=[n.entry.note]),e.next=25,u.run((function(){return p.Pregnancies.save(o)}));case 25:return c=e.sent,console.log("ppppppppppppppp is : ",c),e.next=29,p.Animals.document(n.entry.maleKey);case 29:return i=e.sent,e.next=32,p.Animals.document(n.entry.femaleKey);case 32:if(!0!==(l=e.sent).pregnant){e.next=35;break}throw{status:401,error:"امکان ثبت بارداری برای دام ماده ای که باردار است وجود ندارد"};case 35:return e.next=37,u.run((function(){return p.Animals.update(l,{pregnant:!0})}));case 37:return e.next=39,u.run((function(){return p.AnimalEdges.save({value:"pregnancy",sex:"0",_from:i._id,_to:c._id})}));case 39:return e.next=41,u.run((function(){return p.AnimalEdges.save({value:"pregnancy",sex:"1",_from:l._id,_to:c._id})}));case 41:return e.next=43,u.run((function(){return p.Logs.save({value:"create",type:"pregnancy",entryId:c._id,userId:a._id,createdAt:Date.now()})}));case 43:return e.next=45,u.commit();case 45:t({status:200,result:w}),e.next=53;break;case 48:e.prev=48,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 53:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Mt.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.key,new Promise(function(){var e=Tt(regeneratorRuntime.mark((function e(t,n){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Dt(r);case 3:return s=e.sent,e.next=6,It(s);case 6:a=e.sent,console.log("result is ::: ",a),t({status:200,result:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Mt.post("/readDetails",(function(e,t){var n,r;(n=e.body,r=n.entry.key,new Promise(function(){var e=Ot(regeneratorRuntime.mark((function e(t,n){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ut(r);case 3:return s=e.sent,e.next=6,Nt(s);case 6:a=e.sent,console.log("result is ::: ",a),t({status:200,result:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Mt.post("/remove",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=St(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log(s),e.next=7,qt(s);case 7:return a=e.sent,e.next=10,p.db.beginTransaction({read:["animals","fromAnimalToPregnancy"],write:["animals","logs","pregnancy","fromAnimalToPregnancy"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.pregnancyCollection.document(n.entry.key)}));case 13:return o=e.sent,e.next=16,u.run((function(){return p.animalCollection.document(n.entry.femaleKey)}));case 16:return c=e.sent,e.next=19,p.db.query("\n        FOR v, e IN INBOUND 'pregnancy/".concat(n.entry.key,"' fromAnimalToPregnancy\n        RETURN e\n          "));case 19:return i=e.sent,console.log(i._result),i._result.forEach(function(){var e=St(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.run((function(){return p.fromAnimalToPregnancy.update(t,{deleted:!0})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=24,u.run((function(){return p.pregnancyCollection.update(o,{deleted:!0})}));case 24:if(o.finishedAt){e.next=27;break}return e.next=27,u.run((function(){return p.animalCollection.update(c,{pregnant:!1})}));case 27:return e.next=29,u.run((function(){return p.logCollection.save({mode:"remove",type:"pregnancy",enetryKey:o._key,userKey:a._key})}));case 29:return e.next=31,u.commit();case 31:t({status:200,result:w}),e.next=39;break;case 34:e.prev=34,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 39:case"end":return e.stop()}}),e,null,[[0,34]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Mt.get("/getActive/:animalKey",(function(e,t){console.log("??????????????????",e.params.animalKey)}));var Kt=Mt;function Bt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function jt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Bt(a,r,s,u,o,"next",e)}function o(e){Bt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var Vt=function(e){return new Promise(function(){var t=jt(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Wt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Gt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Wt(a,r,s,u,o,"next",e)}function o(e){Wt(a,r,s,u,o,"throw",e)}u(void 0)}))}}function Ht(e){return Yt.apply(this,arguments)}function Yt(){return(Yt=Gt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var zt=function(e){return console.log({key:e}),new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'disease'\n    Filter vertex.deleted != true\n    return vertex\n    ")),n()}))};function Xt(e){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jt(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function Qt(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){Jt(a,r,s,u,o,"next",e)}function o(e){Jt(a,r,s,u,o,"throw",e)}u(void 0)}))}}var Zt=function(e){return new Promise(function(){var t=Qt(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function $t(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function en(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){$t(a,r,s,u,o,"next",e)}function o(e){$t(a,r,s,u,o,"throw",e)}u(void 0)}))}}var tn=function(e){return new Promise(function(){var t=en(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?("admin"!==s.role&&r({status:401,error:k}),n(s)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},nn=function(e){return new Promise(function(){var t=en(regeneratorRuntime.mark((function t(n,r){var s,a,u,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.a.verify(e.token,g);case 3:return s=t.sent,console.log(s),t.next=7,tn(s);case 7:return a=t.sent,t.next=10,p.db.beginTransaction({read:["diseases"],write:["logs","diseases"]});case 10:return u=t.sent,t.next=13,u.run((function(){return p.Diseases.document(e.entry.key)}));case 13:return o=t.sent,console.log("disease is :: ",o),t.next=17,u.run((function(){return p.Logs.save({value:"update",type:"disease",entryId:o._id,userId:a._id,form:{value:o.value,date:o.date,updatedAt:o.updatedAt,comment:o.comment},to:{value:e.entry.value[0],date:e.entry.date,updatedAt:e.entry.updatedAt,comment:e.entry.comment},createdAt:Date.now()})}));case 17:return t.next=19,u.run((function(){return p.Diseases.update(o,{value:e.entry.value[0],date:e.entry.date,updatedAt:e.entry.updatedAt,comment:e.entry.comment})}));case 19:return t.next=21,u.commit();case 21:n({status:200,result:w}),t.next=29;break;case 24:t.prev=24,t.t0=t.catch(0),console.log(t.t0),t.t0.status&&r(t.t0),r({status:500,error:"خطای سرور"});case 29:case"end":return t.stop()}}),t,null,[[0,24]])})));return function(e,n){return t.apply(this,arguments)}}())};function rn(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function sn(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){rn(a,r,s,u,o,"next",e)}function o(e){rn(a,r,s,u,o,"throw",e)}u(void 0)}))}}var an=function(e){return new Promise(function(){var t=sn(regeneratorRuntime.mark((function t(n,r){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(s=t.sent)?n(s):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function un(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function on(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){un(a,r,s,u,o,"next",e)}function o(e){un(a,r,s,u,o,"throw",e)}u(void 0)}))}}function cn(e){return ln.apply(this,arguments)}function ln(){return(ln=on(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){console.log("resukt is :: ",{docs:t});var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fn=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'diseases/".concat(e,"' diseaseEdges\n    FILTER edge.value == 'step'\n    Filter vertex.deleted != true\n    SORT DATE_TIMESTAMP(vertex.date) DESC\n    return vertex\n    ")),n()}))};function dn(e,t,n,r,s,a,u){try{var o=e[a](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,s)}function pn(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function u(e){dn(a,r,s,u,o,"next",e)}function o(e){dn(a,r,s,u,o,"throw",e)}u(void 0)}))}}function mn(e){return vn.apply(this,arguments)}function vn(){return(vn=pn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var gn=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'disease'\n    FILTER vertex.deleted != true\n    FILTER vertex.active == true\n    SORT DATE_TIMESTAMP(vertex.date) ASC\n    RETURN vertex\n    ")),n()}))},yn=Object(r.Router)();yn.put("/update",(function(e,t){console.log(e.body),nn(e.body).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.post("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=jt(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,e.next=6,Vt(s);case 6:return a=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["diseases","animals","animalEdges","logs"]});case 9:return u=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!0!==(o=e.sent).out){e.next=15;break}throw{status:401,error:b};case 15:return e.next=17,u.run((function(){return p.Diseases.save({value:n.entry.value[0],date:n.entry.date,createdAt:Date.now(),comment:n.entry.comment,active:!0})}));case 17:return c=e.sent,e.next=20,u.run((function(){return p.AnimalEdges.save({value:"disease",_from:"animals/".concat(n.entry.key),_to:c._id})}));case 20:return e.next=22,u.run((function(){return p.Logs.save({value:"create",type:"disease",entryId:o._id,userId:a._id,createdAt:Date.now()})}));case 22:return e.next=24,u.commit();case 24:t({status:200,result:w}),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.get("/:key",(function(e,t){var n;(n=e.params.key,new Promise(function(){var e=Gt(regeneratorRuntime.mark((function e(t,r){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zt(n);case 3:return s=e.sent,e.next=6,Ht(s);case 6:a=e.sent,t({status:200,result:a}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.delete("/:token/:key/:animalKey/:confirmToDeleteOut",(function(e,t){var n,r,s,a;(n=e.params.token,r=e.params.key,s=e.params.animalKey,a=e.params.confirmToDeleteOut,console.log("kkkkkkkkkkk",{key:r}),new Promise(function(){var e=Qt(regeneratorRuntime.mark((function e(t,u){var o,c,i,l,f,d,m,v,y,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return o=e.sent,e.next=6,Zt(o);case 6:return c=e.sent,e.next=9,p.db.beginTransaction({read:["animals","animalEdges","diseaseSteps","exitEdges","exits"],write:["exits","animals","logs","diseases","animalEdges","diseaseSteps","diseaseEdges","exitEdges"]});case 9:return i=e.sent,e.next=12,p.db.query("\n        FOR v, e IN INBOUND 'diseases/".concat(r,"' exitEdges\n        FILTER v.deleted != true\n        RETURN v\n        "));case 12:if(l=e.sent,console.log("___--___--",l._result),console.log({confirmToDeleteOut:Xt(a)}),!l._result.length||"false"!==a){e.next=20;break}throw console.log("----------------------------------------------------"),{status:403,error:"پاک کردن این بیماری منجر به پاک شدن اطلاعات مرتبط با خروج دام میشود. آیا میخواهید ادامه دهید؟"};case 20:if(!l._result.length||"true"!==a){e.next=50;break}return e.next=23,i.run((function(){return p.Animals.document(s)}));case 23:return f=e.sent,e.next=26,i.run((function(){return p.Animals.update(f,{exit:!1})}));case 26:return console.log({animal:f}),e.next=29,p.db.query("\n        FOR v, e IN OUTBOUND 'diseases/".concat(r,"' diseaseEdges\n        FILTER e.value == 'step'\n        FILTER v.deleted != true\n        RETURN v\n        "));case 29:return d=e.sent,console.log({animalSteps:d}),e.next=33,i.run((function(){return p.Diseases.document(r)}));case 33:return m=e.sent,e.next=36,i.run((function(){return p.Diseases.update(m,{deleted:!0})}));case 36:return d._result.forEach(function(){var e=Qt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({step:t}),e.next=3,i.run((function(){return p.DiseaseSteps.update(t,{deleted:!0})}));case 3:return e.next=5,i.run((function(){return p.Logs.save({value:"delete",type:"diseaseSteps",entryId:t._id,userId:c._id,createdAt:Date.now()})}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=39,i.run((function(){return p.Logs.save({value:"delete",type:"disease",entryId:m._id,userId:c._id,createdAt:Date.now()})}));case 39:return e.next=41,i.run((function(){return p.db.query("\n            FOR v, e IN INBOUND 'diseases/".concat(r,"' exitEdges\n              FILTER v.deleted != true\n              return v\n          "))}));case 41:return v=e.sent,e.next=44,i.run((function(){return p.Exits.update(v._result[0],{deleted:!0})}));case 44:return e.next=46,i.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:!0},to:{exit:!1},entryId:f._id,userId:c._id,createdAt:Date.now()})}));case 46:return e.next=48,i.run((function(){return p.Logs.save({value:"delete",type:"exit",entryId:v._id,userId:c._id,createdAt:Date.now()})}));case 48:e.next=61;break;case 50:return e.next=52,p.db.query("\n        FOR v, e IN OUTBOUND 'diseases/".concat(r,"' diseaseEdges\n        FILTER e.value == 'step'\n        FILTER v.deleted != true\n        RETURN v\n        "));case 52:return y=e.sent,e.next=55,i.run((function(){return p.Diseases.document(r)}));case 55:return x=e.sent,e.next=58,i.run((function(){return p.Diseases.update(x,{deleted:!0})}));case 58:return y._result.forEach(function(){var e=Qt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({step:t}),e.next=3,i.run((function(){return p.DiseaseSteps.update(t,{deleted:!0})}));case 3:return e.next=5,i.run((function(){return p.Logs.save({value:"delete",type:"diseaseSteps",entryId:t._id,userId:c._id,createdAt:Date.now()})}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=61,i.run((function(){return p.Logs.save({value:"delete",type:"disease",entryId:x._id,userId:c._id,createdAt:Date.now()})}));case 61:return e.next=63,i.commit();case 63:t({status:200,result:w}),e.next=71;break;case 66:e.prev=66,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&u(e.t0),u({status:500,error:"خطای سرور"});case 71:case"end":return e.stop()}}),e,null,[[0,66]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.put("/",(function(e,t){console.log(e.body),nn(e.body).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.post("/step",(function(e,t){var n;(n=e.body,console.log("---------------------------",n),new Promise(function(){var e=sn(regeneratorRuntime.mark((function e(t,r){var s,a,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return s=e.sent,console.log(s),e.next=7,an(s);case 7:return a=e.sent,e.next=10,p.Animals.document(n.entry.animalKey);case 10:if(!0!==e.sent.out){e.next=13;break}throw{status:401,error:b};case 13:return e.next=15,p.db.beginTransaction({read:["diseases"],write:["diseases","diseaseSteps","diseaseEdges","logs"]});case 15:return u=e.sent,e.next=18,u.run((function(){return p.Diseases.document(n.entry.key)}));case 18:if(!(o=e.sent).isCured){e.next=21;break}throw{status:401,error:"امکان ثبت وضعیت جدید برای بیماری ای که فعال نیست وجود ندارد"};case 21:if(console.log("disease is :: ",o),!n.entry.isCured){e.next=25;break}return e.next=25,u.run((function(){return p.Diseases.update(o,{active:!1})}));case 25:return e.next=27,u.run((function(){return p.DiseaseSteps.save({drugs:n.entry.drugs,effects:n.entry.effects,date:n.entry.date,treatment:n.entry.treatment,comment:n.entry.comment,isCured:n.entry.isCured})}));case 27:return c=e.sent,console.log("related is ::: ",c),e.next=31,u.run((function(){return p.DiseaseEdges.save({value:"step",_from:o._id,_to:c._id})}));case 31:return e.next=33,u.run((function(){return p.Logs.save({value:"create",type:"diseaseStep",entryId:o._id,userId:a._id,createdAt:Date.now()})}));case 33:return e.next=35,u.commit();case 35:t({status:200,result:w}),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 43:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.get("/step/:key",(function(e,t){var n;(n=e.params.key,console.log("got the req, ".concat(n)),new Promise(function(){var e=on(regeneratorRuntime.mark((function e(t,r){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fn(n);case 3:return s=e.sent,e.next=6,cn(s);case 6:a=e.sent,t({status:200,result:a}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),yn.get("/active/:animalKey",(function(e,t){var n;(n=e.params.animalKey,console.log("got the req, ".concat(n)),new Promise(function(){var e=pn(regeneratorRuntime.mark((function e(t,r){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,gn(n);case 3:return s=e.sent,console.log(s),e.next=7,mn(s);case 7:a=e.sent,t({status:200,result:a}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var xn=yn,hn=Object(r.Router)();d()("routes:v0");hn.use("/user",V),hn.use("/animal",ye),hn.use("/logs",Re),hn.use("/weight",Se),hn.use("/expenses",We),hn.use("/vaccine",ut),hn.use("/exit",kt),hn.use("/pregnancy",Kt),hn.use("/disease",xn);var wn={v0:hn};n(0);var Rn=d()("app:server"),kn=process.env.PORT||4e3,bn=s()();bn.use(l()()),bn.use(c.a.urlencoded({extended:!1})),bn.use(c.a.json()),bn.use(u()()),bn.use("/api/v0",wn.v0),bn.listen(kn,(function(){return Rn("app listen to port ".concat(kn))}))}]);