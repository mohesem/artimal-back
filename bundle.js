!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=10)}([function(e,t,n){"use strict";n.r(t),n.d(t,"db",(function(){return te})),n.d(t,"Users",(function(){return ne})),n.d(t,"Animals",(function(){return re})),n.d(t,"Logs",(function(){return ae})),n.d(t,"Weights",(function(){return ue})),n.d(t,"Expenses",(function(){return se})),n.d(t,"Vaccines",(function(){return oe})),n.d(t,"Incomes",(function(){return ce})),n.d(t,"Exits",(function(){return ie})),n.d(t,"Milks",(function(){return le})),n.d(t,"Pregnancies",(function(){return fe})),n.d(t,"Diseases",(function(){return de})),n.d(t,"DiseaseSteps",(function(){return pe})),n.d(t,"Errors",(function(){return me})),n.d(t,"UserEdges",(function(){return ve})),n.d(t,"AnimalEdges",(function(){return ge})),n.d(t,"WeightEdges",(function(){return ye})),n.d(t,"ExpenseEdges",(function(){return he})),n.d(t,"VaccineEdges",(function(){return xe})),n.d(t,"IncomeEdges",(function(){return we})),n.d(t,"ExitEdges",(function(){return Re})),n.d(t,"MilkEdges",(function(){return ke})),n.d(t,"PregnancyEdges",(function(){return be})),n.d(t,"DiseaseEdges",(function(){return _e})),n.d(t,"LogEdges",(function(){return Ee}));var r=n(5),a=n(3);function u(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){u(s,r,a,o,c,"next",e)}function c(e){u(s,r,a,o,c,"throw",e)}o(void 0)}))}}var o=n.n(a)()("app:DB:createCollection");function c(e){return i.apply(this,arguments)}function i(){return(i=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("animals");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("animals collection already exists"):n.create().then((function(){o("animals Collection created")}),(function(e){throw new Error({msg:"Failed to create collection:",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return(f=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("users");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("users collection already exists"):n.create().then((function(){o("users collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return(p=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("logs");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("logs collection already exists"):n.create().then((function(){o("logs collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("weights");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("weights collection already exists"):n.create().then((function(){o("weights collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("expenses");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("expenses collection already exists"):n.create().then((function(){o("expenses collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("vaccines");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("vaccines collection already exists"):n.create().then((function(){o("vaccines collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return R.apply(this,arguments)}function R(){return(R=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("diseases");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("disease collection already exists"):n.create().then((function(){o("disease collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("incomes");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("income collection already exists"):n.create().then((function(){o("income collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return E.apply(this,arguments)}function E(){return(E=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("exits");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("exits collection already exists"):n.create().then((function(){o("exits collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return I.apply(this,arguments)}function I(){return(I=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("milks");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("milks collection already exists"):n.create().then((function(){o("milks collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return A.apply(this,arguments)}function A(){return(A=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("pregnancies");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("pregnancies collection already exists"):n.create().then((function(){o("pregnancies collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return O.apply(this,arguments)}function O(){return(O=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("diseaseSteps");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("diseaseSteps collection already exists"):n.create().then((function(){o("diseaseSteps collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return N.apply(this,arguments)}function N(){return(N=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("animalEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("animalAnimal edgeCollection already exists"):n.create().then((function(){o("animalAnimal edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return U.apply(this,arguments)}function U(){return(U=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("userEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("user edgeCollection already exists"):n.create().then((function(){o("user edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return S.apply(this,arguments)}function S(){return(S=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("exitEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("exit edgeCollection already exists"):n.create().then((function(){o("exit edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return q.apply(this,arguments)}function q(){return(q=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("weightEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("weight edgeCollection already exists"):n.create().then((function(){o("weight edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return K.apply(this,arguments)}function K(){return(K=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("incomeEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("income edgeCollection already exists"):n.create().then((function(){o("income edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return V.apply(this,arguments)}function V(){return(V=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("expenseEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("expense edgeCollection already exists"):n.create().then((function(){o("expense edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return H.apply(this,arguments)}function H(){return(H=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("milkEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("milk edgeCollection already exists"):n.create().then((function(){o("milk edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return Y.apply(this,arguments)}function Y(){return(Y=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("diseaseEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("disease edgeCollection already exists"):n.create().then((function(){o("disease edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return X.apply(this,arguments)}function X(){return(X=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("pregnancyEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("pregnancy edgeCollection already exists"):n.create().then((function(){o("pregnancy edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return J.apply(this,arguments)}function J(){return(J=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("vaccineEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("vaccine edgeCollection already exists"):n.create().then((function(){o("vaccine edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){return Z.apply(this,arguments)}function Z(){return(Z=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.arangoSearchView("animalView"),e.next=3,n.exists();case 3:e.sent?o("animalView laready exists"):n.create().then(s(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("animalView created"),e.next=3,n.setProperties({links:{animals:{includeAllFields:!0}}});case 3:case"end":return e.stop()}}),e)}))),(function(e){throw new Error({msg:"Failed to create view",err:e})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee={host:"localhost",port:"8529",username:"artimal",password:"9KXgTVYmVTBuUuEvURUBBbnfhzwTp4Yc",database:"artimal"},te=new r.Database({url:"http://".concat(ee.host,":").concat(ee.port)});te.useBasicAuth(ee.username,ee.password),te.useDatabase(ee.database),function(e){new Promise((function(t,n){try{s(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c(e);case 2:return n.next=4,l(e);case 4:return n.next=6,d(e);case 6:return n.next=8,m(e);case 8:return n.next=10,g(e);case 10:return n.next=12,h(e);case 12:return n.next=14,w(e);case 14:return n.next=16,D(e);case 16:return n.next=18,k(e);case 18:return n.next=20,_(e);case 20:return n.next=22,P(e);case 22:return n.next=24,T(e);case 24:return n.next=26,F(e);case 26:return n.next=28,L(e);case 28:return n.next=30,M(e);case 30:return n.next=32,B(e);case 32:return n.next=34,$(e);case 34:return n.next=36,G(e);case 36:return n.next=38,j(e);case 38:return n.next=40,C(e);case 40:return n.next=42,W(e);case 42:return n.next=44,z(e);case 44:return n.next=46,Q(e);case 46:t(!0);case 47:case"end":return n.stop()}}),n)})))()}catch(e){n(e)}}))}(te);var ne=te.collection("users"),re=te.collection("animals"),ae=te.collection("logs"),ue=te.collection("weights"),se=te.collection("expenses"),oe=te.collection("vaccines"),ce=te.collection("incomes"),ie=te.collection("exits"),le=te.collection("milks"),fe=te.collection("pregnancies"),de=te.collection("diseases"),pe=te.collection("diseaseSteps"),me=te.collection("errors"),ve=te.edgeCollection("userEdges"),ge=te.edgeCollection("animalEdges"),ye=te.edgeCollection("weightEdges"),he=te.edgeCollection("expenseEdges"),xe=te.edgeCollection("vaccineEdges"),we=te.edgeCollection("incomeEdges"),Re=te.edgeCollection("exitEdges"),ke=te.edgeCollection("milkEdges"),be=te.edgeCollection("pregnancyEdges"),_e=te.edgeCollection("diseaseEdges"),Ee=te.edgeCollection("logEdges")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("arangojs")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t,n){"use strict";n.r(t);n(9);var r=n(2),a=n.n(r),u=n(7),s=n.n(u),o=n(6),c=n.n(o),i=n(8),l=n.n(i),f=n(3),d=n.n(f),p=n(0),m="testKey",v=10,g="testKey",y="توکن فرستاده شده اشتباه است",h="کاربری با این مشخصات یافت نشد",x="اشکال در درخواست فرستاده شده",w="دامی با این پلاک یافت نشد",R="عملیات با موفقیت انجام شد",k="اطلاعات مورد نظر یافت نشد",b="شما اجازه ی انجام این عملیاتن را ندارید",_="امکان انجام این عملایات برایس دامی که از سیستم خارج شده است وجود ندارد",E=n(4),P=n.n(E),I=n(1),T=n.n(I);function A(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){A(u,r,a,s,o,"next",e)}function o(e){A(u,r,a,s,o,"throw",e)}s(void 0)}))}}function O(e){return F.apply(this,arguments)}function F(){return(F=D(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query('FOR user IN users\n    FILTER user.username == "'.concat(t,'"\n    RETURN user')).then((function(t){var r=t._result;r.length?e(r[0]):n({status:401,error:"نام کاربری وارد شده اشتباه است"})})).catch((function(e){n({status:500,error:"خطای سرور"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){return L.apply(this,arguments)}function L(){return(L=D(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){P.a.compare(n+m,t.password,(function(t,n){t&&r({status:500,error:"خطای سرور"}),n?e():r({status:401,error:"پسورد وارد شده اشتباه است"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return C.apply(this,arguments)}function C(){return(C=D(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){T.a.sign({key:t._key,username:t.username},g,(function(t,r){t?n({status:500,error:"خطای سرور"}):e(r)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var M=function(e){return new Promise(function(){var t,n=(t=regeneratorRuntime.mark((function t(n,r){var a,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.a.verify(e,g);case 3:return a=t.sent,t.next=6,p.Users.document("users/".concat(a.key));case 6:if(u=t.sent){t.next=9;break}throw new Error({status:400,error:y});case 9:u.username===a.username?n({status:200,result:{role:u.role}}):r({status:400,error:y}),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log("getUserByToken error ::: ",t.t0),t.t0.status?r(t.t0):r({status:500,error:"خطای سرور"});case 16:case"end":return t.stop()}}),t,null,[[0,12]])})),function(){var e=this,n=arguments;return new Promise((function(r,a){var u=t.apply(e,n);function s(e){S(u,r,a,s,o,"next",e)}function o(e){S(u,r,a,s,o,"throw",e)}s(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())};function q(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){q(u,r,a,s,o,"next",e)}function o(e){q(u,r,a,s,o,"throw",e)}s(void 0)}))}}var K=function(e){return new Promise(function(){var t=j(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},B=function(e){return new Promise((function(t,n){P.a.hash(e+m,v,function(){var e=j(regeneratorRuntime.mark((function e(r,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&n({error:"internal server error"}),t(a);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}))},V=Object(r.Router)();V.post("/login",(function(e,t){var n,r,a;(n=e.body,r=n.username,a=n.password,new Promise(function(){var e=D(regeneratorRuntime.mark((function e(t,n){var u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O(r);case 3:return u=e.sent,e.next=6,N(u,a);case 6:return e.next=8,U(u);case 8:s=e.sent,t({status:200,token:s}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("login error ::: ",e.t0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({token:e.token})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),V.get("/token/:token",(function(e,t){M(e.params.token).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),V.post("/",(function(e,t){var n;console.log("got the req",e.body),(n=e.body,console.log(n),new Promise(function(){var e=j(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log({decoded:a}),e.next=7,K(a);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({read:["users"],write:["users","logs"]});case 10:return s=e.sent,e.next=13,s.run((function(){return p.db.query("\n        FOR user IN users\n          FILTER user.username == '".concat(n.entry.username,"'\n          RETURN user\n        "))}));case 13:if(!e.sent._result.length){e.next=16;break}throw{status:400,error:{username:"نام کاربری تکراری است"}};case 16:return e.next=18,B(n.entry.password);case 18:return o=e.sent,console.log({hash:o}),e.next=22,s.run((function(){return p.Users.save({username:n.entry.username,password:o,role:1===n.entry.role?"admin":"user"})}));case 22:return c=e.sent,e.next=25,s.run((function(){return p.Logs.save({value:"create",type:"user",entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 25:return console.log({newUser:c}),e.next=28,s.commit();case 28:t({status:200,result:R}),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 36:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var W=V;function H(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function G(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){H(u,r,a,s,o,"next",e)}function o(e){H(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Y=function(e){return new Promise(function(){var t=G(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document("users/".concat(e.key));case 2:(a=t.sent)||r({status:401,msg:h}),a.username!==e.username?r({status:401,msg:h}):n(a);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function z(e,t){return X.apply(this,arguments)}function X(){return(X=G(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(t.weight||n({status:400,error:x}),t.type||n({status:400,error:x}),t.key||n({status:400,error:x}),t.entryDate||n({status:400,error:x}),t.birthDate||n({status:400,error:x}),"گاو"===t.type||t.race||n({status:400,error:x}),"number"!=typeof t.sex&&n({status:400,error:x}),"گوسفند"!==t.type||t.gene||n({status:400,error:x}),0!==t.entryType||t.pregnancyKey||n({status:400,error:x}),1!==t.entryType||t.shopDate||n({status:400,error:x}),0!==t.entryType||t.fatherKey&&t.motherKey||n({status:400,error:x}),0===t.entryType)e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0});else if(1===t.entryType){e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,shopDate:t.shopDate,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0})}else if(2===t.entryType){e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0,exit:!1})}else n({status:400,error:x})})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=function(e){return new Promise((function(t){var n={};e.split("&&").forEach((function(e){var t=e.split(":");n[t[0]]=t[1]})),t(n)}))};function J(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){J(u,r,a,s,o,"next",e)}function o(e){J(u,r,a,s,o,"throw",e)}s(void 0)}))}}function Z(e){return ee.apply(this,arguments)}function ee(){return(ee=Q(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result,r=n.map((function(e){return{key:e._key,type:e.type,race:e.race}}));n.length?(console.log(t._result),e(r)):e({result:[]})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(e){return new Promise((function(t,n){var r='FOR animal IN animalView\n    SEARCH STARTS_WITH(animal._key, "'.concat(e.key,'")\n    ').concat(e.sex?"FILTER animal.sex == ".concat(e.sex):"","\n    ").concat(e.type?'FILTER animal.type == "'.concat(e.type,'"'):"","\n    ").concat(e.entryType?'FILTER animal.entryType == "'.concat(e.entryType,'"'):"","\n    ").concat(e.race?'FILTER animal.race == "'.concat(e.race,'"'):"","\n    ").concat(e.limit?"LIMIT ".concat(e.limit):"","\n    RETURN animal");console.log(r),t(r),n()}))};function ne(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function re(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){ne(u,r,a,s,o,"next",e)}function o(e){ne(u,r,a,s,o,"throw",e)}s(void 0)}))}}function ae(e){return ue.apply(this,arguments)}function ue(){return(ue=re(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.abrupt("return",new Promise(function(){var e=re(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Animals.document(t);case 3:a=e.sent,console.log(a),n(a),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var oe=function(){return new Promise(function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.Animals.count();case 2:(r=e.sent).error?n({status:500,error:"خطای سرور"}):t({status:200,result:r.count+1});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){se(u,r,a,s,o,"next",e)}function o(e){se(u,r,a,s,o,"throw",e)}s(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())};function ce(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){ce(u,r,a,s,o,"next",e)}function o(e){ce(u,r,a,s,o,"throw",e)}s(void 0)}))}}function le(e){return fe.apply(this,arguments)}function fe(){return(fe=ie(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=ie(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.db.query("\n        FOR pregnancy, edge IN OUTBOUND 'animals/".concat(t,"' animalEdges\n        FILTER edge.value == 'pregnancy'\n        FILTER pregnancy.deleted != true\n        FOR animal IN INBOUND pregnancy._id animalEdges\n        FILTER animal.sex == 0\n        SORT DATE_TIMESTAMP(pregnancy.startedAt) DESC\n        RETURN {pregnancy, male: animal}\n        "));case 3:a=e.sent,n(a._result),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function pe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){de(u,r,a,s,o,"next",e)}function o(e){de(u,r,a,s,o,"throw",e)}s(void 0)}))}}function me(e){return ve.apply(this,arguments)}function ve(){return(ve=pe(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=pe(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.db.query("\n        FOR vaccine, edge IN OUTBOUND 'animals/".concat(t,"' animalEdges\n        FILTER edge.value == 'vaccine'\n        Filter vaccine.deleted != true\n        return vaccine\n        "));case 3:a=e.sent,console.log(a._result),n(a._result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ye(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){ge(u,r,a,s,o,"next",e)}function o(e){ge(u,r,a,s,o,"throw",e)}s(void 0)}))}}function he(e){return xe.apply(this,arguments)}function xe(){return(xe=ye(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){p.db.query("\n            FOR animal IN animals\n            FILTER animal.exit != true\n            COLLECT type = animal.type, race = animal.race WITH COUNT INTO countType\n            return {race, type, countType }\n          ").then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var we=Object(r.Router)();we.get("/newKey",(function(e,t){oe().then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.get("/stock/:string",(function(e,t){var n;(n=e.params.string,console.log(n),new Promise(function(){var e=Q(regeneratorRuntime.mark((function e(t,r){var a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(n);case 2:return a=e.sent,e.next=5,te(a);case 5:return u=e.sent,e.prev=6,e.next=9,Z(u);case 9:s=e.sent,t({status:200,result:s}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(6),console.log(e.t0),r({status:500,msg:"خطای سرور"});case 17:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.get("/detail/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=re(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae(n);case 3:a=e.sent,t({status:200,details:a}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({details:e.details})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.get("/pregnancy/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=ie(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,le(n);case 3:a=e.sent,console.log("result is :: ",a),t({status:200,result:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.post("/new",(function(e,t){var n;(n=e.body,new Promise(function(){var e=G(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i,l,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,Y(a);case 6:return u=e.sent,e.next=9,p.Animals.documentExists("".concat(n.animal.key));case 9:if(!0!==e.sent){e.next=12;break}throw{status:401,error:"دامی با پلاک مشابه در دیتابیس ثبت شده است"};case 12:return e.next=14,z(n.animal,a);case 14:return s=e.sent,e.next=17,p.db.beginTransaction({read:["pregnancies","animals"],write:["logs","animals","weights","expenses","pregnancies","pregnancyEdges","animalEdges"]});case 17:return o=e.sent,e.next=20,o.run((function(){return p.Animals.save(s)}));case 20:return c=e.sent,e.next=23,o.run((function(){return p.Weights.save({value:"number"==typeof n.animal.weight?n.animal.weight:Number(n.animal.weight),createdAt:Date.now(),date:n.animal.entryDate})}));case 23:return i=e.sent,e.next=26,o.run((function(){return p.AnimalEdges.save({value:"weight",_from:c._id,_to:i._id})}));case 26:return e.next=28,o.run((function(){return p.Logs.save({value:"create",type:"animal",animalId:c._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 28:return e.next=30,o.run((function(){return p.Logs.save({value:"create",type:"weight",animalId:c._id,entryId:i._id,userId:u._id,createdAt:Date.now()})}));case 30:if(0!==n.animal.entryType){e.next=46;break}return e.next=33,o.run((function(){return p.Pregnancies.document(n.animal.pregnancyKey)}));case 33:if(!(l=e.sent).active){e.next=42;break}return e.next=37,o.run((function(){return p.Animals.document(n.animal.motherKey)}));case 37:return f=e.sent,e.next=40,o.run((function(){return p.Pregnancies.update(l,{active:!1})}));case 40:return e.next=42,o.run((function(){return p.Animals.update(f,{pregnant:!1})}));case 42:return console.log(l),console.log("sex: :: :: ",n.animal.sex),e.next=46,o.run((function(){p.PregnancyEdges.save({sex:n.animal.sex,_from:l._id,_to:c._id})}));case 46:return e.next=48,o.commit();case 48:t({status:200,result:"دام با موفقیت ایجاد شد"}),e.next=55;break;case 51:e.prev=51,e.t0=e.catch(0),console.log(e.t0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 55:case"end":return e.stop()}}),e,null,[[0,51]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.get("/vaccine/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=pe(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me(n);case 3:a=e.sent,console.log("result is :: ",a),t({status:200,result:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.get("/total",(function(e,t){new Promise((function(e,t){try{p.db.query("\n        FOR animal IN animals\n        FILTER animal.deleted != true\n        FILTER animal.exit != true\n        COLLECT WITH COUNT INTO length\n        RETURN length\n        ").then((function(t){var n=t._result;e({status:200,result:n})})).catch((function(e){throw new Error({status:500,error:"خطای سرور"})}))}catch(e){e.status?t(e):t({status:500,error:"خطای سرور"})}})).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),we.get("/count",(function(e,t){new Promise(function(){var e=ye(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,he();case 3:r=e.sent,console.log({result:r}),t({status:200,result:r}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:serverError});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Re=we;function ke(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var be=function(e,t,n,r){return console.log("__+++++____----__-=++ ",{value:r}),new Promise(function(){var a,u=(a=regeneratorRuntime.mark((function a(u,s){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:try{p.db.query("\n        FOR log IN logs\n      ".concat("null"!==r?"FILTER log.value == '".concat(r,"'"):"","\n      ").concat("null"!==n?"FILTER log.type == '".concat(n,"'"):"","\n        SORT DATE_TIMESTAMP(log.createdAt) DESC\n        LIMIT ").concat(Number(t)*Number(e),", ").concat(Number(t+1)*Number(e),"\n        return log\n        ")).then((function(e){u({status:200,result:e._result})}))}catch(e){console.log(e),s({status:500,msg:"خطای سرور"})}case 1:case"end":return a.stop()}}),a)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var u=a.apply(e,t);function s(e){ke(u,n,r,s,o,"next",e)}function o(e){ke(u,n,r,s,o,"throw",e)}s(void 0)}))});return function(e,t){return u.apply(this,arguments)}}())},_e=Object(r.Router)();_e.get("/pagination/:limit/:page/:collection?/:value?",(function(e,t){be(e.params.limit,e.params.page,e.params.collection,e.params.value).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Ee=_e;function Pe(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var Ie=function(e,t){return new Promise(function(){var n,r=(n=regeneratorRuntime.mark((function n(r,a){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{p.db.query("\n        FOR log IN logs\n        FILTER log.value == 'error'\n        SORT DATE_TIMESTAMP(log.createdAt) DESC\n        LIMIT ".concat(Number(t)*Number(e),", ").concat(Number(t+1)*Number(e),"\n        return log\n        ")).then((function(e){console.log(e._result),r({status:200,result:e._result})}))}catch(e){console.log(e),a({status:500,msg:"خطای سرور"})}case 1:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,a){var u=n.apply(e,t);function s(e){Pe(u,r,a,s,o,"next",e)}function o(e){Pe(u,r,a,s,o,"throw",e)}s(void 0)}))});return function(e,t){return r.apply(this,arguments)}}())},Te=Object(r.Router)();Te.get("/pagination/:limit/:page",(function(e,t){console.log("__--__-_--_-----_"),Ie(e.params.limit,e.params.page).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Ae=Te;function De(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Oe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){De(u,r,a,s,o,"next",e)}function o(e){De(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Fe=function(e){return new Promise(function(){var t=Oe(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:"دامی با این پلاک وجود ندارد"});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Ne(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Le(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Ne(u,r,a,s,o,"next",e)}function o(e){Ne(u,r,a,s,o,"throw",e)}s(void 0)}))}}function Ue(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=Le(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=function(e){return new Promise((function(t,n){t("\n    FOR weight, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'weight'\n    FILTER weight.deleted != true\n    RETURN weight\n    ")),n()}))};function Me(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function qe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Me(u,r,a,s,o,"next",e)}function o(e){Me(u,r,a,s,o,"throw",e)}s(void 0)}))}}var je=function(e){return new Promise(function(){var t=qe(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Ke(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Be(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Ke(u,r,a,s,o,"next",e)}function o(e){Ke(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Ve=function(e){return new Promise(function(){var t=Be(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},We=Object(r.Router)();We.get("/:animalKey",(function(e,t){var n;(n=e.params.animalKey,new Promise(function(){var e=Le(regeneratorRuntime.mark((function e(t,r){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Se(n);case 3:return a=e.sent,e.next=6,Ue(a);case 6:u=e.sent,t({status:200,result:u}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),We.post("/new",(function(e,t){var n;(n=e.body,console.log("================================",n),new Promise(function(){var e=Oe(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,Fe(a);case 6:return u=e.sent,e.next=9,p.Animals.documentExists("".concat(n.entry.key));case 9:return e.sent||r({status:400,error:w}),e.next=13,p.Animals.document(n.entry.key);case 13:if(!0!==(s=e.sent).out){e.next=16;break}throw{status:401,error:animalIsOut};case 16:return e.next=18,p.db.beginTransaction({write:["logs","animals","weights","animalEdges"]});case 18:return o=e.sent,e.next=21,o.run((function(){return p.Weights.save({value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),createdAt:Date.now(),date:n.entry.date,stopFeedingMilk:n.entry.stopFeedingMilk})}));case 21:return c=e.sent,e.next=24,o.run((function(){return p.AnimalEdges.save({value:"weight",_from:"animals/".concat(n.entry.key),_to:c._id})}));case 24:return e.next=26,o.run((function(){return p.Logs.save({value:"create",type:"weight",animalId:s._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 26:return e.next=28,o.commit();case 28:t({status:200,result:R}),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 36:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),We.delete("/:token/:key/:animalKey",(function(e,t){var n,r;console.log("reeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeemove"),(n=e.params.token,r=e.params.key,e.params.animalKey,new Promise(function(){var e=qe(regeneratorRuntime.mark((function e(t,a){var u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return u=e.sent,console.log(u),e.next=7,je(u);case 7:return s=e.sent,e.next=10,p.db.beginTransaction({read:["weights","animals"],write:["logs","weights"]});case 10:return o=e.sent,e.next=13,o.run((function(){return p.Animals.document(r)}));case 13:return c=e.sent,e.next=16,o.run((function(){return p.Weights.document(r)}));case 16:return i=e.sent,e.next=19,o.run((function(){return p.Weights.update(i,{deleted:!0,deleteDate:Date.now()})}));case 19:return e.next=21,o.run((function(){return p.Logs.save({value:"delete",type:"weight",animalId:c._id,entryId:i._id,userId:s._id,createdAt:Date.now()})}));case 21:return e.next=23,o.commit();case 23:t({status:200,result:R}),e.next=31;break;case 26:e.prev=26,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&a(e.t0),a({status:500,error:"خطای سرور"});case 31:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),We.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=Be(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log(a),e.next=7,Ve(a);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({read:["animals"],write:["logs","weights"]});case 10:return s=e.sent,e.next=13,s.run((function(){return p.Animals.document(n.entry.key)}));case 13:return o=e.sent,e.next=16,s.run((function(){return p.Weights.document(n.entry.key)}));case 16:return c=e.sent,console.log("weight is :: ",c),e.next=20,s.run((function(){return p.Logs.save({value:"update",type:"weight",animalId:o._id,entryId:c._id,userId:u._id,form:{date:c.date,value:c.value,stopFeedingMilk:c.stopFeedingMilk},to:{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date,stopFeedingMilk:n.entry.stopFeedingMilk},createdAt:Date.now()})}));case 20:return e.next=22,s.run((function(){return p.Weights.update(c,{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date,updatedAt:n.entry.updatedAt,stopFeedingMilk:n.entry.stopFeedingMilk})}));case 22:return e.next=24,s.commit();case 24:t({status:200,result:R}),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var He=We;function Ge(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ye(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Ge(u,r,a,s,o,"next",e)}function o(e){Ge(u,r,a,s,o,"throw",e)}s(void 0)}))}}function ze(e){return Xe.apply(this,arguments)}function Xe(){return(Xe=Ye(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;r.length?e(r):n({status:404,error:k})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $e=function(e,t){return new Promise((function(n,r){n("FOR expense IN expenses\n    FILTER expense.deleted != true\n    FILTER DATE_TIMESTAMP(expense.createdAt) >= DATE_TIMESTAMP('".concat(e,"') && DATE_TIMESTAMP(expense.createdAt) <= DATE_TIMESTAMP('").concat(t,"')\n    COLLECT AGGREGATE v = SUM(expense.value)\n    RETURN v")),r()}))},Je=Object(r.Router)();Je.get("/:from/:to",(function(e,t){var n,r;(n=e.params.from,r=e.params.to,new Promise(function(){var e=Ye(regeneratorRuntime.mark((function e(t,a){var u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e(n,r);case 2:return u=e.sent,e.prev=3,e.next=6,ze(u);case 6:s=e.sent,t({status:200,result:s}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),e.t0.status?a(e.t0):a({status:500,msg:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Qe=Je;function Ze(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function et(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Ze(u,r,a,s,o,"next",e)}function o(e){Ze(u,r,a,s,o,"throw",e)}s(void 0)}))}}var tt=function(e){return new Promise(function(){var t=et(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function nt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function rt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){nt(u,r,a,s,o,"next",e)}function o(e){nt(u,r,a,s,o,"throw",e)}s(void 0)}))}}function at(e){return ut.apply(this,arguments)}function ut(){return(ut=rt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var st=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR vaccine IN 1..1 OUTBOUND animal fromAnimalToVaccine\n    FILTER vaccine.deleted != true\n    SORT DATE_TIMESTAMP(vaccine.createdAt) ASC\n    RETURN {vaccine}\n    ")),n()}))};function ot(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ct(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){ot(u,r,a,s,o,"next",e)}function o(e){ot(u,r,a,s,o,"throw",e)}s(void 0)}))}}var it=function(e){return new Promise(function(){var t=ct(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function lt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ft(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){lt(u,r,a,s,o,"next",e)}function o(e){lt(u,r,a,s,o,"throw",e)}s(void 0)}))}}var dt=function(e){return new Promise(function(){var t=ft(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},pt=Object(r.Router)();pt.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.keys,console.log("got the req, ".concat(r)),new Promise(function(){var e=rt(regeneratorRuntime.mark((function e(t,n){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.length){e.next=14;break}return e.prev=1,e.next=4,st(r[0]);case 4:return a=e.sent,e.next=7,at(a);case 7:u=e.sent,t({status:200,result:u}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),pt.post("/",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=et(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log(a),e.next=7,tt(a);case 7:return u=e.sent,e.next=10,p.Animals.documentExists("".concat(n.entry.key));case 10:if(s=e.sent,console.log("****&&&^^^",s),s){e.next=14;break}throw{status:400,error:w};case 14:return e.next=16,p.db.beginTransaction({read:["animals"],write:["vaccines","animals","animalEdges","logs"]});case 16:return o=e.sent,e.next=19,p.Animals.document(n.entry.key);case 19:if(!0!==(c=e.sent).out){e.next=22;break}throw{status:401,error:_};case 22:return console.log("animal is ::: ",c),e.next=25,o.run((function(){return p.Vaccines.save({value:n.entry.vaccine,date:n.entry.date,createdAt:Date.now()})}));case 25:return i=e.sent,e.next=28,o.run((function(){return p.AnimalEdges.save({value:"vaccine",_from:c._id,_to:i._id})}));case 28:return e.next=30,o.run((function(){return p.Logs.save({value:"create",type:"vaccine",animalId:c._id,entryId:i._id,userId:u._id,createdAt:Date.now()})}));case 30:return e.next=32,o.commit();case 32:t({status:200,result:R}),e.next=40;break;case 35:e.prev=35,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 40:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),pt.delete("/:token/:key/:animalKey",(function(e,t){var n,r;(n=e.params.token,r=e.params.key,e.params.animalKey,new Promise(function(){var e=ct(regeneratorRuntime.mark((function e(t,a){var u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return u=e.sent,console.log(u),e.next=7,it(u);case 7:return s=e.sent,e.next=10,p.db.beginTransaction({read:["animals"],write:["logs","vaccines"]});case 10:return o=e.sent,e.next=13,o.run((function(){return p.Animals.document(r)}));case 13:return c=e.sent,e.next=16,o.run((function(){return p.Vaccines.document(r)}));case 16:return i=e.sent,e.next=19,o.run((function(){return p.Vaccines.update(i,{deleted:!0})}));case 19:return e.next=21,o.run((function(){return p.Logs.save({value:"delete",type:"vaccine",animalId:c.id,entryId:i._id,userId:s._id,createdAt:Date.now()})}));case 21:return e.next=23,o.commit();case 23:t({status:200,result:R}),e.next=31;break;case 26:e.prev=26,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&a(e.t0),a({status:500,error:"خطای سرور"});case 31:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),pt.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=ft(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log(a),e.next=7,dt(a);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({read:["animals"],write:["logs","vaccines"]});case 10:return s=e.sent,e.next=13,s.run((function(){return p.Animals.document(n.entry.key)}));case 13:return o=e.sent,e.next=16,s.run((function(){return p.Vaccines.document(n.entry.key)}));case 16:return c=e.sent,e.next=19,s.run((function(){return p.Logs.save({value:"update",type:"vaccine",animalId:o._id,entryId:c._id,userId:u._id,form:{date:c.date,value:c.value,updatedAt:c.updatedAt},to:{value:n.entry.value,date:n.entry.date,updatedAt:n.entry.updatedAt},createdAt:Date.now()})}));case 19:return e.next=21,s.run((function(){return p.Vaccines.update(c,{value:n.entry.value,date:n.entry.date,updatedAt:n.entry.updatedAt})}));case 21:return e.next=23,s.commit();case 23:t({status:200,result:R}),e.next=31;break;case 26:e.prev=26,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 31:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var mt=pt;n(5);function vt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function gt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){vt(u,r,a,s,o,"next",e)}function o(e){vt(u,r,a,s,o,"throw",e)}s(void 0)}))}}var yt=function(e){return new Promise(function(){var t=gt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function ht(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function xt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){ht(u,r,a,s,o,"next",e)}function o(e){ht(u,r,a,s,o,"throw",e)}s(void 0)}))}}var wt=function(e){return new Promise(function(){var t=xt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Rt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function kt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Rt(u,r,a,s,o,"next",e)}function o(e){Rt(u,r,a,s,o,"throw",e)}s(void 0)}))}}var bt=function(e){return new Promise(function(){var t=kt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function _t(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Et(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){_t(u,r,a,s,o,"next",e)}function o(e){_t(u,r,a,s,o,"throw",e)}s(void 0)}))}}function Pt(e){return It.apply(this,arguments)}function It(){return(It=Et(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;e(r),n()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Tt=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'exit'\n    Filter vertex.deleted != true\n    return vertex\n    ")),n()}))},At=Object(r.Router)();At.get("/:animalKey",(function(e,t){var n;(n=e.params.animalKey,new Promise(function(){var e=Et(regeneratorRuntime.mark((function e(t,r){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Tt(n);case 3:return a=e.sent,e.next=6,Pt(a);case 6:u=e.sent,console.log("result is ::: ",u),t({status:200,result:u[0]}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),At.post("/sell",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=xt(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,wt(a);case 6:return u=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["animals","exits","incomes","animalEdges","logs"]});case 9:return s=e.sent,e.next=12,s.run((function(){return p.Animals.document(n.entry.key)}));case 12:if(!(o=e.sent).exit){e.next=15;break}throw{status:400,error:"امکان ثبت فروش برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 15:return e.next=17,s.run((function(){return p.Animals.update(o,{exit:!0})}));case 17:return e.next=19,s.run((function(){return p.Exits.save({type:"sell",date:n.entry.date,comment:n.entry.comment,createdAt:Date.now()})}));case 19:return c=e.sent,e.next=22,s.run((function(){return p.Incomes.save({type:"sell",date:n.entry.date,price:"number"==typeof n.entry.price?n.entry.price:Number(n.entry.price),createdAt:Date.now()})}));case 22:return i=e.sent,e.next=25,s.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:i._id})}));case 25:return e.next=27,s.run((function(){return p.AnimalEdges.save({value:"income",_from:o._id,_to:c._id})}));case 27:return e.next=29,s.run((function(){return p.Logs.save({value:"create",type:"exit",animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 29:return e.next=31,s.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 31:return e.next=33,s.run((function(){return p.Logs.save({value:"create",type:"income",animalId:o._id,entryId:i._id,userId:u._id,createdAt:Date.now()})}));case 33:return e.next=35,s.commit();case 35:t({status:200,result:R}),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 43:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),At.post("/slaughter",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=kt(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,bt(a);case 6:return u=e.sent,e.next=9,p.db.beginTransaction({write:["animals","exits","animalEdges","weights","logs"]});case 9:return s=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!(o=e.sent).exit){e.next=16;break}throw console.log("animal is out"),{status:400,error:"امکان ثبت ذبح برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 16:return e.next=18,s.run((function(){return p.Animals.update(o,{exit:!0})}));case 18:return e.next=20,s.run((function(){return p.Exits.save({type:"slaughter",date:n.entry.date,createdAt:Date.now()})}));case 20:return c=e.sent,e.next=23,s.run((function(){return p.Weights.save({value:"number"==typeof n.entry.weight?n.entry.weight:Number(n.entry.weight),createdAt:Date.now(),date:n.entry.date})}));case 23:return i=e.sent,e.next=26,s.run((function(){return p.AnimalEdges.save({value:"weight",_from:o._id,_to:i._id})}));case 26:return e.next=28,s.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:c._id})}));case 28:return e.next=30,s.run((function(){return p.Logs.save({value:"create",type:"exit",animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 30:return e.next=32,s.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 32:return e.next=34,s.run((function(){return p.Logs.save({value:"create",type:"weight",animalId:o._id,entryId:i._id,userId:u._id,createdAt:Date.now()})}));case 34:return e.next=36,s.commit();case 36:t({status:200,result:R}),e.next=44;break;case 39:e.prev=39,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 44:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({msg:e.msg})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),At.post("/death",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=gt(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,yt(a);case 6:return u=e.sent,e.next=9,p.db.beginTransaction({write:["animals","exits","animalEdges","diseases","diseaseSteps","exitEdges","diseaseEdges","logs"]});case 9:return s=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!(o=e.sent).out){e.next=16;break}throw console.log("**************"),{status:400,error:"امکان ثبت مرگ برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 16:return e.next=18,s.run((function(){return p.Animals.update(o,{exit:!0})}));case 18:return e.next=20,s.run((function(){return p.Exits.save({type:"death",reason:n.entry.reason,disease:"بیماری"===n.entry.reason?n.entry.disease.value:void 0,date:n.entry.date,createdAt:Date.now(),comment:n.entry.comment})}));case 20:return c=e.sent,e.next=23,s.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:c._id})}));case 23:return e.next=25,s.run((function(){return p.db.query("\n          FOR vertex, edge IN OUTBOUND 'animals/".concat(n.entry.key,"' animalEdges\n          FILTER edge.value == 'disease'\n          FILTER vertex.deleted != true\n          FILTER vertex.active == true\n          RETURN vertex\n          "))}));case 25:return e.sent._result.forEach(function(){var e=gt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.run((function(){return p.Diseases.update(t,{active:!1})}));case 2:return e.next=4,s.run((function(){return p.Logs.save({value:"update",type:"disease",from:{active:!0},to:{active:!1},animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=29,s.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 29:return e.next=31,s.run((function(){return p.Logs.save({value:"create",type:"exit",animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 31:if("بیماری"!==n.entry.reason){e.next=40;break}return console.log("##############################################################"),e.next=35,s.run((function(){return p.DiseaseSteps.save({drugs:n.entry.drugs,effects:n.entry.effects,treatment:n.entry.treatment,comment:n.entry.comment,isCured:n.entry.isCured,date:n.entry.date,createdAt:Date.now(),died:!0})}));case 35:return i=e.sent,e.next=38,s.run((function(){return p.DiseaseEdges.save({value:"step",_from:n.entry.disease._id,_to:i._id})}));case 38:return e.next=40,s.run((function(){return p.ExitEdges.save({value:"disease",_from:c._id,_to:n.entry.disease._id})}));case 40:return e.next=42,s.commit();case 42:t({status:200,result:R}),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 50:case"end":return e.stop()}}),e,null,[[0,45]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Dt=At;function Ot(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ft(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Ot(u,r,a,s,o,"next",e)}function o(e){Ot(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Nt=function(e){return new Promise(function(){var t=Ft(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:h});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Lt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ut(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Lt(u,r,a,s,o,"next",e)}function o(e){Lt(u,r,a,s,o,"throw",e)}s(void 0)}))}}function Ct(e){return St.apply(this,arguments)}function St(){return(St=Ut(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Mt=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'milk'\n    FILTER vertex.deleted != true\n    RETURN vertex\n    ")),n()}))};function qt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function jt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){qt(u,r,a,s,o,"next",e)}function o(e){qt(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Kt=function(e){return new Promise(function(){var t=jt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Bt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Vt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Bt(u,r,a,s,o,"next",e)}function o(e){Bt(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Wt=function(e){return new Promise(function(){var t=Vt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},Ht=Object(r.Router)();Ht.post("/",(function(e,t){var n;(n=e.body,console.log("::::::::",n),new Promise(function(){var e=Ft(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,Nt(a);case 6:return u=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["milks","animalEdges","logs"]});case 9:return s=e.sent,e.next=12,s.run((function(){return p.Animals.document(n.entry.key)}));case 12:if(1===(o=e.sent).sex){e.next=15;break}throw{error:"امکان ثبت رکرد شیر فقط برای دام های ماده ممکن است"};case 15:return e.next=17,s.run((function(){return p.Milks.save({date:n.entry.date,value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),createdAt:Date.now()})}));case 17:return c=e.sent,e.next=20,s.run((function(){return p.AnimalEdges.save({value:"milk",_from:o._id,_to:c._id})}));case 20:return e.next=22,s.run((function(){return p.Logs.save({value:"create",type:"milk",animalId:o._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 22:return e.next=24,s.commit();case 24:t({status:200,result:R}),e.next=31;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.t0.response&&e.t0.response.body?(i=function(){if(404===e.t0.response.body.code)return"سند مورد نظر یافت نشد"},r({status:e.t0.response.body.code,error:i()})):e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 31:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Ht.get("/:key",(function(e,t){var n;(n=e.params.key,new Promise(function(){var e=Ut(regeneratorRuntime.mark((function e(t,r){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Mt(n);case 3:return a=e.sent,e.next=6,Ct(a);case 6:u=e.sent,t({status:200,result:u}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Ht.delete("/:token/:key/:animalKey",(function(e,t){var n,r,a;(n=e.params.token,r=e.params.key,a=e.params.animalKey,new Promise(function(){var e=jt(regeneratorRuntime.mark((function e(t,u){var s,o,c,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return s=e.sent,console.log(s),e.next=7,Kt(s);case 7:return o=e.sent,e.next=10,p.db.beginTransaction({read:["milks","animals"],write:["logs","milks"]});case 10:return c=e.sent,e.next=13,c.run((function(){return p.Animals.document(a)}));case 13:return i=e.sent,e.next=16,c.run((function(){return p.Milks.document(r)}));case 16:return l=e.sent,e.next=19,c.run((function(){return p.Milks.update(l,{deleted:!0,deleteDate:Date.now()})}));case 19:return e.next=21,c.run((function(){return p.Logs.save({value:"delete",type:"milk",animalId:i._id,entryId:l._id,userId:o._id,createdAt:Date.now()})}));case 21:e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&u(e.t0),u({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Ht.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=Vt(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log(a),e.next=7,Wt(a);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({read:["animals"],write:["logs","milks"]});case 10:return s=e.sent,e.next=13,s.run((function(){return p.Animals.document(n.entry.animalKey)}));case 13:return o=e.sent,e.next=16,s.run((function(){return p.Milks.document(n.entry.key)}));case 16:return c=e.sent,console.log("miiiilk is :: ",c),e.next=20,s.run((function(){return p.Logs.save({value:"update",type:"milk",animalId:o._id,entryId:c._id,userId:u._id,form:{date:c.date,value:c.value,stopFeedingMilk:c.stopFeedingMilk},to:{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date,stopFeedingMilk:n.entry.stopFeedingMilk},createdAt:Date.now()})}));case 20:return e.next=22,s.run((function(){return p.Milks.update(c,{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date,updatedAt:Date.now()})}));case 22:return e.next=24,s.commit();case 24:t({status:200,result:R}),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Gt=Ht;function Yt(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function zt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Yt(u,r,a,s,o,"next",e)}function o(e){Yt(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Xt=function(e){return new Promise(function(){var t=zt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function $t(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Jt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){$t(u,r,a,s,o,"next",e)}function o(e){$t(u,r,a,s,o,"throw",e)}s(void 0)}))}}function Qt(e){return Zt.apply(this,arguments)}function Zt(){return(Zt=Jt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;e(r),n()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var en=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR pregnancy IN 1..1 OUTBOUND animal fromAnimalToPregnancy\n    FOR male IN 1..1 INBOUND pregnancy fromAnimalToPregnancy\n    FILTER pregnancy.deleted != true\n    FILTER male.sex == 0\n    SORT DATE_TIMESTAMP(pregnancy.startedAt) ASC\n    RETURN {pregnancy, male}\n    ")),n()}))};function tn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function nn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){tn(u,r,a,s,o,"next",e)}function o(e){tn(u,r,a,s,o,"throw",e)}s(void 0)}))}}function rn(e){return an.apply(this,arguments)}function an(){return(an=nn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){console.log("***************",t);var r=t._result;r.length?e(r):n({status:404,error:k})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var un=function(e){return new Promise((function(t,n){t("\n    FOR edge IN pregnancy\n    FILTER edge._key == '".concat(e,"'\n    FOR parent IN 1..1 INBOUND edge fromAnimalToPregnancy\n    RETURN {parent}\n    ")),n()}))};function sn(e){return function(e){if(Array.isArray(e))return on(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return on(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return on(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function on(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ln(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){cn(u,r,a,s,o,"next",e)}function o(e){cn(u,r,a,s,o,"throw",e)}s(void 0)}))}}var fn=function(e){return new Promise(function(){var t=ln(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},dn=function(){var e=ln(regeneratorRuntime.mark((function e(t,n,r,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiin"),e.abrupt("return",new Promise(function(){var e=ln(regeneratorRuntime.mark((function e(u){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.forEach(function(){var e=ln(regeneratorRuntime.mark((function e(s,o){var c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=s.errors?[].concat(sn(s.errors),["hasNoPregnancyRecord"]):["hasNoPregnancyRecord"],e.next=3,t.run((function(){return p.Animals.update(s,{errors:c})}));case 3:return e.next=5,t.run((function(){return p.Logs.save({value:"error",type:"hasNoPregnancyRecord",entryId:s._id,userId:n._id,createdAt:Date.now(),previousPregnancyId:r._id})}));case 5:console.log(";;;;;;;;;;;;;;;;;,"),o===a.length-1&&u();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function yn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){gn(u,r,a,s,o,"next",e)}function o(e){gn(u,r,a,s,o,"throw",e)}s(void 0)}))}}function hn(e){return xn.apply(this,arguments)}function xn(){return(xn=yn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wn=function(e){return new Promise((function(t,n){t("\n      FOR vertex, edge IN OUTBOUND 'pregnancies/".concat(e,"' pregnancyEdges\n      RETURN vertex\n    ")),n()}))},Rn=function(e){return new Promise(function(){var t=yn(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],e.forEach(function(){var t=yn(regeneratorRuntime.mark((function t(r,u){var s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s="\n        FOR vertex , edge IN OUTBOUND '".concat(r._id,"' animalEdges\n        FILTER edge.value == 'weight'\n        SORT DATE_TIMESTAMP(vertex.date) ASC\n        LIMIT 1\n        RETURN vertex\n      "),console.log(s),t.next=4,hn(s);case 4:o=t.sent,console.log({weight:o}),a.push(mn({},r,{weight:o[0]})),u==e.length-1&&n(a);case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},kn=Object(r.Router)();kn.post("/new",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=zt(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log(a),e.next=7,Xt(a);case 7:return u=e.sent,e.next=10,p.Animals.documentExists(n.entry.maleKey);case 10:if(e.sent){e.next=13;break}throw{status:400,error:w};case 13:return e.next=15,p.Animals.documentExists(n.entry.femaleKey);case 15:if(e.sent){e.next=18;break}throw{status:400,error:w};case 18:return e.next=20,p.db.beginTransaction({read:["animals"],write:["animals","logs","pregnancies","animalEdges"]});case 20:return s=e.sent,o={startedAt:n.entry.date,createdAt:Date.now(),active:!0},n.entry.note&&(o.notes=[n.entry.note]),e.next=25,s.run((function(){return p.Pregnancies.save(o)}));case 25:return c=e.sent,console.log("ppppppppppppppp is : ",c),e.next=29,p.Animals.document(n.entry.maleKey);case 29:return i=e.sent,e.next=32,p.Animals.document(n.entry.femaleKey);case 32:if(!0!==(l=e.sent).pregnant){e.next=35;break}throw{status:401,error:"امکان ثبت بارداری برای دام ماده ای که باردار است وجود ندارد"};case 35:return e.next=37,s.run((function(){return p.Animals.update(l,{pregnant:!0})}));case 37:return e.next=39,s.run((function(){return p.AnimalEdges.save({value:"pregnancy",sex:"0",_from:i._id,_to:c._id})}));case 39:return e.next=41,s.run((function(){return p.AnimalEdges.save({value:"pregnancy",sex:"1",_from:l._id,_to:c._id})}));case 41:return e.next=43,s.run((function(){return p.Logs.save({value:"create",type:"pregnancy",sex:"male",animalId:i._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 43:return e.next=45,s.run((function(){return p.Logs.save({value:"create",type:"pregnancy",sex:"female",animalId:l._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 45:return e.next=47,s.commit();case 47:t({status:200,result:R}),e.next=55;break;case 50:e.prev=50,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 55:case"end":return e.stop()}}),e,null,[[0,50]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),kn.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.key,new Promise(function(){var e=Jt(regeneratorRuntime.mark((function e(t,n){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,en(r);case 3:return a=e.sent,e.next=6,Qt(a);case 6:u=e.sent,console.log("result is ::: ",u),t({status:200,result:u}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),kn.post("/readDetails",(function(e,t){var n,r;(n=e.body,r=n.entry.key,new Promise(function(){var e=nn(regeneratorRuntime.mark((function e(t,n){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,un(r);case 3:return a=e.sent,e.next=6,rn(a);case 6:u=e.sent,console.log("result is ::: ",u),t({status:200,result:u}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),kn.get("/getActive/:animalKey",(function(e,t){console.log("??????????????????",e.params.animalKey)})),kn.get("/details/:key",(function(e,t){var n;(n=e.params.key,new Promise(function(){var e=yn(regeneratorRuntime.mark((function e(t,r){var a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wn(n);case 3:return a=e.sent,e.next=6,hn(a);case 6:return u=e.sent,e.next=9,Rn(u);case 9:s=e.sent,console.log("result is ::: ",s),t({status:200,result:s}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),kn.delete("/:token/:key",(function(e,t){var n,r;console.log("got the requset"),(n=e.params.token,r=e.params.key,new Promise(function(){var e=ln(regeneratorRuntime.mark((function e(t,a){var u,s,o,c,i,l,f,d,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return u=e.sent,e.next=6,fn(u);case 6:return s=e.sent,e.next=9,p.db.beginTransaction({read:["animals","pregnancies","pregnancyEdges"],write:["animals","logs","pregnancies"]});case 9:return o=e.sent,e.next=12,o.run((function(){return p.Pregnancies.document(r)}));case 12:return c=e.sent,e.next=15,o.run((function(){return p.db.query("\n            FOR vertex , edge IN OUTBOUND '".concat(c._id,"' pregnancyEdges\n            FILTER vertex.deleted != true\n            RETURN vertex\n          "))}));case 15:return i=e.sent,l=i._result,e.next=19,o.run((function(){return p.db.query("\n          FOR vertex , edge IN INBOUND '".concat(c._id,"' animalEdges\n          FILTER vertex.deleted != true\n          RETURN vertex\n          "))}));case 19:if(f=e.sent,d=f._result,m=d.filter((function(e){return 1===e.sex}))[0],!c.active){e.next=27;break}return e.next=25,o.run((function(){return p.Animals.update(m,{pregnant:!1,updatedAt:Date.now()})}));case 25:return e.next=27,o.run((function(){return p.Logs.save({value:"delete",type:"pregnancy",entryId:c._id,userId:s._id,createdAt:Date.now(),from:{pregnant:!0},to:{pregnant:!1}})}));case 27:return e.next=29,o.run((function(){return p.Pregnancies.update(c,{deleted:!0,deletedAt:Date.now()})}));case 29:return e.next=31,o.run((function(){return p.Logs.save({value:"delete",type:"pregnancy",entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 31:return e.next=33,dn(o,s,c,l);case 33:return console.log("ooooooooooooooooooooooout"),e.next=36,o.commit();case 36:t({status:200,result:R}),e.next=44;break;case 39:e.prev=39,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&a(e.t0),a({status:500,error:"خطای سرور"});case 44:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var bn=kn;function _n(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function En(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){_n(u,r,a,s,o,"next",e)}function o(e){_n(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Pn=function(e){return new Promise(function(){var t=En(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function In(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Tn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){In(u,r,a,s,o,"next",e)}function o(e){In(u,r,a,s,o,"throw",e)}s(void 0)}))}}function An(e){return Dn.apply(this,arguments)}function Dn(){return(Dn=Tn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var On=function(e){return console.log({key:e}),new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'disease'\n    Filter vertex.deleted != true\n    return vertex\n    ")),n()}))};function Fn(e){return(Fn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ln(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Nn(u,r,a,s,o,"next",e)}function o(e){Nn(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Un=function(e){return new Promise(function(){var t=Ln(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Cn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Sn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Cn(u,r,a,s,o,"next",e)}function o(e){Cn(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Mn=function(e){return new Promise(function(){var t=Sn(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:b}),n(a)):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},qn=function(e){return new Promise(function(){var t=Sn(regeneratorRuntime.mark((function t(n,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,T.a.verify(e.token,g);case 3:return a=t.sent,console.log(a),t.next=7,Mn(a);case 7:return u=t.sent,t.next=10,p.db.beginTransaction({read:["diseases"],write:["logs","diseases"]});case 10:return s=t.sent,t.next=13,s.run((function(){return p.Diseases.document(e.entry.key)}));case 13:return o=t.sent,t.next=16,s.run((function(){return p.Animals.document(e.entry.animalKey)}));case 16:return c=t.sent,console.log("disease is :: ",o),t.next=20,s.run((function(){return p.Logs.save({value:"update",type:"disease",animalId:c._id,entryId:o._id,userId:u._id,form:{value:o.value,date:o.date,updatedAt:o.updatedAt,comment:o.comment},to:{value:e.entry.value[0],date:e.entry.date,updatedAt:e.entry.updatedAt,comment:e.entry.comment},createdAt:Date.now()})}));case 20:return t.next=22,s.run((function(){return p.Diseases.update(o,{value:e.entry.value[0],date:e.entry.date,updatedAt:e.entry.updatedAt,comment:e.entry.comment})}));case 22:return t.next=24,s.commit();case 24:n({status:200,result:R}),t.next=32;break;case 27:t.prev=27,t.t0=t.catch(0),console.log(t.t0),t.t0.status&&r(t.t0),r({status:500,error:"خطای سرور"});case 32:case"end":return t.stop()}}),t,null,[[0,27]])})));return function(e,n){return t.apply(this,arguments)}}())};function jn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Kn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){jn(u,r,a,s,o,"next",e)}function o(e){jn(u,r,a,s,o,"throw",e)}s(void 0)}))}}var Bn=function(e){return new Promise(function(){var t=Kn(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:y});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Vn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Wn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){Vn(u,r,a,s,o,"next",e)}function o(e){Vn(u,r,a,s,o,"throw",e)}s(void 0)}))}}function Hn(e){return Gn.apply(this,arguments)}function Gn(){return(Gn=Wn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){console.log("resukt is :: ",{docs:t});var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yn=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'diseases/".concat(e,"' diseaseEdges\n    FILTER edge.value == 'step'\n    Filter vertex.deleted != true\n    SORT DATE_TIMESTAMP(vertex.date) DESC\n    return vertex\n    ")),n()}))};function zn(e,t,n,r,a,u,s){try{var o=e[u](s),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Xn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function s(e){zn(u,r,a,s,o,"next",e)}function o(e){zn(u,r,a,s,o,"throw",e)}s(void 0)}))}}function $n(e){return Jn.apply(this,arguments)}function Jn(){return(Jn=Xn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qn=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'disease'\n    FILTER vertex.deleted != true\n    FILTER vertex.active == true\n    SORT DATE_TIMESTAMP(vertex.date) ASC\n    RETURN vertex\n    ")),n()}))},Zn=Object(r.Router)();Zn.put("/update",(function(e,t){console.log(e.body),qn(e.body).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.post("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=En(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,e.next=6,Pn(a);case 6:return u=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["diseases","animals","animalEdges","logs"]});case 9:return s=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!0!==(o=e.sent).out){e.next=15;break}throw{status:401,error:_};case 15:return e.next=17,s.run((function(){return p.Diseases.save({value:n.entry.value[0],date:n.entry.date,createdAt:Date.now(),comment:n.entry.comment,active:!0})}));case 17:return c=e.sent,e.next=20,s.run((function(){return p.AnimalEdges.save({value:"disease",_from:"animals/".concat(n.entry.key),_to:c._id})}));case 20:return e.next=22,s.run((function(){return p.Logs.save({value:"create",type:"disease",animalId:o._id,entryId:o._id,userId:u._id,createdAt:Date.now()})}));case 22:return e.next=24,s.commit();case 24:t({status:200,result:R}),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.get("/:key",(function(e,t){var n;(n=e.params.key,new Promise(function(){var e=Tn(regeneratorRuntime.mark((function e(t,r){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,On(n);case 3:return a=e.sent,e.next=6,An(a);case 6:u=e.sent,t({status:200,result:u}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.delete("/:token/:key/:animalKey/:confirmToDeleteOut",(function(e,t){var n,r,a,u;(n=e.params.token,r=e.params.key,a=e.params.animalKey,u=e.params.confirmToDeleteOut,console.log("kkkkkkkkkkk",{key:r}),new Promise(function(){var e=Ln(regeneratorRuntime.mark((function e(t,s){var o,c,i,l,f,d,m,v,y,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n,g);case 3:return o=e.sent,e.next=6,Un(o);case 6:return c=e.sent,e.next=9,p.db.beginTransaction({read:["animals","animalEdges","diseaseSteps","exitEdges","exits"],write:["exits","animals","logs","diseases","animalEdges","diseaseSteps","diseaseEdges","exitEdges"]});case 9:return i=e.sent,e.next=12,i.run((function(){return p.Animals.document(a)}));case 12:return l=e.sent,e.next=15,p.db.query("\n        FOR v, e IN INBOUND 'diseases/".concat(r,"' exitEdges\n        FILTER v.deleted != true\n        RETURN v\n        "));case 15:if(f=e.sent,console.log("___--___--",f._result),console.log({confirmToDeleteOut:Fn(u)}),!f._result.length||"false"!==u){e.next=23;break}throw console.log("----------------------------------------------------"),{status:403,error:"پاک کردن این بیماری منجر به پاک شدن اطلاعات مرتبط با خروج دام میشود. آیا میخواهید ادامه دهید؟"};case 23:if(!f._result.length||"true"!==u){e.next=50;break}return e.next=26,i.run((function(){return p.Animals.update(l,{exit:!1})}));case 26:return console.log({animal:l}),e.next=29,p.db.query("\n        FOR v, e IN OUTBOUND 'diseases/".concat(r,"' diseaseEdges\n        FILTER e.value == 'step'\n        FILTER v.deleted != true\n        RETURN v\n        "));case 29:return d=e.sent,console.log({animalSteps:d}),e.next=33,i.run((function(){return p.Diseases.document(r)}));case 33:return m=e.sent,e.next=36,i.run((function(){return p.Diseases.update(m,{deleted:!0})}));case 36:return d._result.forEach(function(){var e=Ln(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({step:t}),e.next=3,i.run((function(){return p.DiseaseSteps.update(t,{deleted:!0})}));case 3:return e.next=5,i.run((function(){return p.Logs.save({value:"delete",type:"diseaseSteps",animalId:l._id,entryId:t._id,userId:c._id,createdAt:Date.now()})}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=39,i.run((function(){return p.Logs.save({value:"delete",type:"disease",animalId:l._id,entryId:m._id,userId:c._id,createdAt:Date.now()})}));case 39:return e.next=41,i.run((function(){return p.db.query("\n            FOR v, e IN INBOUND 'diseases/".concat(r,"' exitEdges\n              FILTER v.deleted != true\n              return v\n          "))}));case 41:return v=e.sent,e.next=44,i.run((function(){return p.Exits.update(v._result[0],{deleted:!0})}));case 44:return e.next=46,i.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:!0},to:{exit:!1},animalId:l._id,entryId:l._id,userId:c._id,createdAt:Date.now()})}));case 46:return e.next=48,i.run((function(){return p.Logs.save({value:"delete",type:"exit",animalId:l._id,entryId:v._id,userId:c._id,createdAt:Date.now()})}));case 48:e.next=61;break;case 50:return e.next=52,p.db.query("\n        FOR v, e IN OUTBOUND 'diseases/".concat(r,"' diseaseEdges\n        FILTER e.value == 'step'\n        FILTER v.deleted != true\n        RETURN v\n        "));case 52:return y=e.sent,e.next=55,i.run((function(){return p.Diseases.document(r)}));case 55:return h=e.sent,e.next=58,i.run((function(){return p.Diseases.update(h,{deleted:!0})}));case 58:return y._result.forEach(function(){var e=Ln(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({step:t}),e.next=3,i.run((function(){return p.DiseaseSteps.update(t,{deleted:!0})}));case 3:return e.next=5,i.run((function(){return p.Logs.save({value:"delete",type:"diseaseSteps",animalId:l._id,entryId:t._id,userId:c._id,createdAt:Date.now()})}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=61,i.run((function(){return p.Logs.save({value:"delete",type:"disease",animalId:l._id,entryId:h._id,userId:c._id,createdAt:Date.now()})}));case 61:return e.next=63,i.commit();case 63:t({status:200,result:R}),e.next=71;break;case 66:e.prev=66,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&s(e.t0),s({status:500,error:"خطای سرور"});case 71:case"end":return e.stop()}}),e,null,[[0,66]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.put("/",(function(e,t){console.log(e.body),qn(e.body).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.post("/step",(function(e,t){var n;(n=e.body,console.log("---------------------------",n),new Promise(function(){var e=Kn(regeneratorRuntime.mark((function e(t,r){var a,u,s,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.a.verify(n.token,g);case 3:return a=e.sent,console.log(a),e.next=7,Bn(a);case 7:return u=e.sent,e.next=10,p.Animals.document(n.entry.animalKey);case 10:if(!0!==(s=e.sent).out){e.next=13;break}throw{status:401,error:_};case 13:return e.next=15,p.db.beginTransaction({read:["diseases"],write:["diseases","diseaseSteps","diseaseEdges","logs"]});case 15:return o=e.sent,e.next=18,o.run((function(){return p.Diseases.document(n.entry.key)}));case 18:if(!(c=e.sent).isCured){e.next=21;break}throw{status:401,error:"امکان ثبت وضعیت جدید برای بیماری ای که فعال نیست وجود ندارد"};case 21:if(console.log("disease is :: ",c),!n.entry.isCured){e.next=25;break}return e.next=25,o.run((function(){return p.Diseases.update(c,{active:!1})}));case 25:return e.next=27,o.run((function(){return p.DiseaseSteps.save({drugs:n.entry.drugs,effects:n.entry.effects,date:n.entry.date,treatment:n.entry.treatment,comment:n.entry.comment,isCured:n.entry.isCured})}));case 27:return i=e.sent,console.log("related is ::: ",i),e.next=31,o.run((function(){return p.DiseaseEdges.save({value:"step",_from:c._id,_to:i._id})}));case 31:return e.next=33,o.run((function(){return p.Logs.save({value:"create",type:"diseaseStep",animalId:s._id,entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 33:return e.next=35,o.commit();case 35:t({status:200,result:R}),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 43:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.get("/step/:key",(function(e,t){var n;(n=e.params.key,console.log("got the req, ".concat(n)),new Promise(function(){var e=Wn(regeneratorRuntime.mark((function e(t,r){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Yn(n);case 3:return a=e.sent,e.next=6,Hn(a);case 6:u=e.sent,t({status:200,result:u}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Zn.get("/active/:animalKey",(function(e,t){var n;(n=e.params.animalKey,console.log("got the req, ".concat(n)),new Promise(function(){var e=Xn(regeneratorRuntime.mark((function e(t,r){var a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Qn(n);case 3:return a=e.sent,console.log(a),e.next=7,$n(a);case 7:u=e.sent,t({status:200,result:u}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var er=Zn,tr=Object(r.Router)();d()("routes:v0");tr.use("/user",W),tr.use("/animal",Re),tr.use("/logs",Ee),tr.use("/errors",Ae),tr.use("/weight",He),tr.use("/expenses",Qe),tr.use("/vaccine",mt),tr.use("/exit",Dt),tr.use("/milk",Gt),tr.use("/pregnancy",bn),tr.use("/disease",er);var nr={v0:tr};n(0);var rr=d()("app:server"),ar=process.env.PORT||4e3,ur=a()();ur.use(l()()),ur.use(c.a.urlencoded({extended:!1})),ur.use(c.a.json()),ur.use(s()()),ur.use("/api/v0",nr.v0),ur.listen(ar,(function(){return rr("app listen to port ".concat(ar))}))}]);