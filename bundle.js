!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=10)}([function(e,t,n){"use strict";n.r(t),n.d(t,"db",(function(){return te})),n.d(t,"Users",(function(){return ne})),n.d(t,"Animals",(function(){return re})),n.d(t,"Logs",(function(){return ae})),n.d(t,"Weights",(function(){return se})),n.d(t,"Expenses",(function(){return ue})),n.d(t,"Vaccines",(function(){return oe})),n.d(t,"Incomes",(function(){return ce})),n.d(t,"Exits",(function(){return ie})),n.d(t,"Milks",(function(){return le})),n.d(t,"Pregnancies",(function(){return fe})),n.d(t,"Diseases",(function(){return de})),n.d(t,"DiseaseSteps",(function(){return pe})),n.d(t,"Errors",(function(){return me})),n.d(t,"UserEdges",(function(){return ve})),n.d(t,"AnimalEdges",(function(){return ge})),n.d(t,"WeightEdges",(function(){return ye})),n.d(t,"ExpenseEdges",(function(){return xe})),n.d(t,"VaccineEdges",(function(){return he})),n.d(t,"IncomeEdges",(function(){return we})),n.d(t,"ExitEdges",(function(){return Re})),n.d(t,"MilkEdges",(function(){return ke})),n.d(t,"PregnancyEdges",(function(){return be})),n.d(t,"DiseaseEdges",(function(){return Ee})),n.d(t,"LogEdges",(function(){return _e}));var r=n(4),a=n(3);function s(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function o(e){s(u,r,a,o,c,"next",e)}function c(e){s(u,r,a,o,c,"throw",e)}o(void 0)}))}}var o=n.n(a)()("app:DB:createCollection");function c(e){return i.apply(this,arguments)}function i(){return(i=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("animals");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("animals collection already exists"):n.create().then((function(){o("animals Collection created")}),(function(e){throw new Error({msg:"Failed to create collection:",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return(f=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("users");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("users collection already exists"):n.create().then((function(){o("users collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){return p.apply(this,arguments)}function p(){return(p=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("logs");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("logs collection already exists"):n.create().then((function(){o("logs collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("weights");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("weights collection already exists"):n.create().then((function(){o("weights collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("expenses");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("expenses collection already exists"):n.create().then((function(){o("expenses collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return h.apply(this,arguments)}function h(){return(h=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("vaccines");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("vaccines collection already exists"):n.create().then((function(){o("vaccines collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return R.apply(this,arguments)}function R(){return(R=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("diseases");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("disease collection already exists"):n.create().then((function(){o("disease collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("incomes");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("income collection already exists"):n.create().then((function(){o("income collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return _.apply(this,arguments)}function _(){return(_=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("exits");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("exits collection already exists"):n.create().then((function(){o("exits collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return T.apply(this,arguments)}function T(){return(T=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("milks");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("milks collection already exists"):n.create().then((function(){o("milks collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return A.apply(this,arguments)}function A(){return(A=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("pregnancies");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("pregnancies collection already exists"):n.create().then((function(){o("pregnancies collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return F.apply(this,arguments)}function F(){return(F=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.collection("diseaseSteps");case 2:return n=e.sent,e.next=5,n.exists();case 5:e.sent?o("diseaseSteps collection already exists"):n.create().then((function(){o("diseaseSteps collection created")}),(function(e){throw new Error({msg:"Failed to create collection",err:e})}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return N.apply(this,arguments)}function N(){return(N=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("animalEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("animalAnimal edgeCollection already exists"):n.create().then((function(){o("animalAnimal edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return L.apply(this,arguments)}function L(){return(L=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("userEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("user edgeCollection already exists"):n.create().then((function(){o("user edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return S.apply(this,arguments)}function S(){return(S=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("exitEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("exit edgeCollection already exists"):n.create().then((function(){o("exit edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return M.apply(this,arguments)}function M(){return(M=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("weightEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("weight edgeCollection already exists"):n.create().then((function(){o("weight edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return B.apply(this,arguments)}function B(){return(B=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("incomeEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("income edgeCollection already exists"):n.create().then((function(){o("income edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return V.apply(this,arguments)}function V(){return(V=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("expenseEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("expense edgeCollection already exists"):n.create().then((function(){o("expense edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return G.apply(this,arguments)}function G(){return(G=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("milkEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("milk edgeCollection already exists"):n.create().then((function(){o("milk edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return Y.apply(this,arguments)}function Y(){return(Y=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("diseaseEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("disease edgeCollection already exists"):n.create().then((function(){o("disease edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return X.apply(this,arguments)}function X(){return(X=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("pregnancyEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("pregnancy edgeCollection already exists"):n.create().then((function(){o("pregnancy edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return Q.apply(this,arguments)}function Q(){return(Q=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.edgeCollection("vaccineEdges");case 2:return n=e.sent,e.next=5,n.exists();case 5:r=e.sent,console.log(".......",r),r?o("vaccine edgeCollection already exists"):n.create().then((function(){o("vaccine edgeCollection created")}),(function(e){throw new Error({msg:"Failed to create edgeCollection",err:e})}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return $.apply(this,arguments)}function $(){return($=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.arangoSearchView("animalView"),e.next=3,n.exists();case 3:e.sent?o("animalView laready exists"):n.create().then(u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("animalView created"),e.next=3,n.setProperties({links:{animals:{includeAllFields:!0}}});case 3:case"end":return e.stop()}}),e)}))),(function(e){throw new Error({msg:"Failed to create view",err:e})}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee={host:"localhost",port:"8529",username:"artimal",password:"9KXgTVYmVTBuUuEvURUBBbnfhzwTp4Yc",database:"artimal"},te=new r.Database({url:"http://".concat(ee.host,":").concat(ee.port)});te.useBasicAuth(ee.username,ee.password),te.useDatabase(ee.database),function(e){new Promise((function(t,n){try{u(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c(e);case 2:return n.next=4,l(e);case 4:return n.next=6,d(e);case 6:return n.next=8,m(e);case 8:return n.next=10,g(e);case 10:return n.next=12,x(e);case 12:return n.next=14,w(e);case 14:return n.next=16,D(e);case 16:return n.next=18,k(e);case 18:return n.next=20,E(e);case 20:return n.next=22,P(e);case 22:return n.next=24,I(e);case 24:return n.next=26,O(e);case 26:return n.next=28,C(e);case 28:return n.next=30,q(e);case 30:return n.next=32,j(e);case 32:return n.next=34,J(e);case 34:return n.next=36,H(e);case 36:return n.next=38,K(e);case 38:return n.next=40,U(e);case 40:return n.next=42,W(e);case 42:return n.next=44,z(e);case 44:return n.next=46,Z(e);case 46:t(!0);case 47:case"end":return n.stop()}}),n)})))()}catch(e){n(e)}}))}(te);var ne=te.collection("users"),re=te.collection("animals"),ae=te.collection("logs"),se=te.collection("weights"),ue=te.collection("expenses"),oe=te.collection("vaccines"),ce=te.collection("incomes"),ie=te.collection("exits"),le=te.collection("milks"),fe=te.collection("pregnancies"),de=te.collection("diseases"),pe=te.collection("diseaseSteps"),me=te.collection("errors"),ve=te.edgeCollection("userEdges"),ge=te.edgeCollection("animalEdges"),ye=te.edgeCollection("weightEdges"),xe=te.edgeCollection("expenseEdges"),he=te.edgeCollection("vaccineEdges"),we=te.edgeCollection("incomeEdges"),Re=te.edgeCollection("exitEdges"),ke=te.edgeCollection("milkEdges"),be=te.edgeCollection("pregnancyEdges"),Ee=te.edgeCollection("diseaseEdges"),_e=te.edgeCollection("logEdges")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("arangojs")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t,n){"use strict";n.r(t);n(9);var r=n(2),a=n.n(r),s=n(6),u=n.n(s),o=n(5),c=n.n(o),i=n(7),l=n.n(i),f=n(3),d=n.n(f),p=n(0),m="testKey",v="testKey",g="توکن فرستاده شده اشتباه است",y="اشکال در درخواست فرستاده شده",x="دامی با این پلاک یافت نشد",h="عملیات با موفقیت انجام شد",w="اطلاعات مورد نظر یافت نشد",R="شما اجازه ی انجام این عملیاتن را ندارید",k="امکان انجام این عملایات برایس دامی که از سیستم خارج شده است وجود ندارد",b=n(8),E=n.n(b),_=n(1),P=n.n(_);function T(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function I(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){T(s,r,a,u,o,"next",e)}function o(e){T(s,r,a,u,o,"throw",e)}u(void 0)}))}}function A(e){return D.apply(this,arguments)}function D(){return(D=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query('FOR user IN users\n    FILTER user.username == "'.concat(t,'"\n    RETURN user')).then((function(t){var r=t._result;r.length?e(r[0]):n({status:401,error:"نام کاربری وارد شده اشتباه است"})})).catch((function(e){n({status:500,error:"خطای سرور"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t){return O.apply(this,arguments)}function O(){return(O=I(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){E.a.compare(n+m,t.password,(function(t,n){t&&r({status:500,error:"خطای سرور"}),n?e():r({status:401,error:"پسورد وارد شده اشتباه است"})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return C.apply(this,arguments)}function C(){return(C=I(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){P.a.sign({key:t._key,username:t.username},v,(function(t,r){t?n({status:500,error:"خطای سرور"}):e(r)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var U=function(e){return new Promise(function(){var t,n=(t=regeneratorRuntime.mark((function t(n,r){var a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,P.a.verify(e,v);case 3:return a=t.sent,t.next=6,p.Users.document("users/".concat(a.key));case 6:if(s=t.sent){t.next=9;break}throw new Error({status:400,error:g});case 9:s.username===a.username?n({status:200,result:{role:s.role}}):r({status:400,error:g}),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.log("getUserByToken error ::: ",t.t0),t.t0.status?r(t.t0):r({status:500,error:"خطای سرور"});case 16:case"end":return t.stop()}}),t,null,[[0,12]])})),function(){var e=this,n=arguments;return new Promise((function(r,a){var s=t.apply(e,n);function u(e){L(s,r,a,u,o,"next",e)}function o(e){L(s,r,a,u,o,"throw",e)}u(void 0)}))});return function(e,t){return n.apply(this,arguments)}}())},S=Object(r.Router)();S.post("/login",(function(e,t){var n,r,a;(n=e.body,r=n.username,a=n.password,new Promise(function(){var e=I(regeneratorRuntime.mark((function e(t,n){var s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A(r);case 3:return s=e.sent,e.next=6,F(s,a);case 6:return e.next=8,N(s);case 8:u=e.sent,t({status:200,token:u}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("login error ::: ",e.t0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({token:e.token})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),S.get("/token/:token",(function(e,t){U(e.params.token).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var q=S;function M(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function K(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){M(s,r,a,u,o,"next",e)}function o(e){M(s,r,a,u,o,"throw",e)}u(void 0)}))}}var B=function(e){return new Promise(function(){var t=K(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document("users/".concat(e.key));case 2:(a=t.sent)||r({status:401,msg:"کاربری با این مشخصات یافت نشد"}),a.username!==e.username?r({status:401,msg:"کاربری با این مشخصات یافت نشد"}):n(a);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function j(e,t){return V.apply(this,arguments)}function V(){return(V=K(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("animal is :: ",t),e.abrupt("return",new Promise((function(e,n){if(t.weight||n({status:400,error:y}),console.log(!t.weight,2),t.type||n({status:400,error:y}),t.key||n({status:400,error:y}),t.entryDate||n({status:400,error:y}),t.birthDate||n({status:400,error:y}),"گاو"===t.type||t.race||n({status:400,error:y}),"number"!=typeof t.sex&&n({status:400,error:y}),"گوسفند"!==t.type||t.gene||n({status:400,error:y}),1!==t.entryType||t.price||n({status:400,error:y}),0!==t.entryType||t.fatherKey&&t.motherKey||n({status:400,error:y}),0===t.entryType)e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0});else if(1===t.entryType){e({_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0})}else if(2===t.entryType){var r={_key:t.key,birthDate:t.birthDate,entryType:t.entryType,type:t.type,race:t.race,sex:t.sex,createdAt:Date.now(),gene:"گوسفند"===t.type?t.gene:void 0,exit:!1};console.log(r),e(r)}else n({status:400,error:y})})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function G(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){W(s,r,a,u,o,"next",e)}function o(e){W(s,r,a,u,o,"throw",e)}u(void 0)}))}}function H(e){return Y.apply(this,arguments)}function Y(){return(Y=G(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result,r=n.map((function(e){return{key:e._key,type:e.type,race:e.race}}));n.length?(console.log(t._result),e(r)):e({result:[]})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=function(e,t,n,r,a){return new Promise((function(s,u){var o='FOR animal IN animalView\n    SEARCH STARTS_WITH(animal._key, "'.concat(e,'")\n    ').concat(void 0!==t?"FILTER animal.sex == ".concat(t):"","\n    ").concat(a?'FILTER animal.race == "'.concat(a,'"'):"","\n    ").concat(n?'FILTER animal.type == "'.concat(n,'"'):"","\n\n    ").concat(r?"LIMIT ".concat(r):"","\n    RETURN animal");console.log(o),s(o),u()}))},X=function(e,t,n,r,a){return new Promise(function(){var s=G(regeneratorRuntime.mark((function s(u,o){var c,i;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,z(t,n,r,e,a);case 2:return c=s.sent,s.prev=3,s.next=6,H(c);case 6:i=s.sent,console.log("..........",i),u({status:200,result:i}),s.next=15;break;case 11:s.prev=11,s.t0=s.catch(3),console.log(s.t0),o({status:500,msg:"خطای سرور"});case 15:case"end":return s.stop()}}),s,null,[[3,11]])})));return function(e,t){return s.apply(this,arguments)}}())};function J(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){J(s,r,a,u,o,"next",e)}function o(e){J(s,r,a,u,o,"throw",e)}u(void 0)}))}}function Z(e){return $.apply(this,arguments)}function $(){return($=Q(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.abrupt("return",new Promise(function(){var e=Q(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Animals.document(t);case 3:a=e.sent,console.log(a),n(a),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var te=function(){return new Promise(function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.Animals.count();case 2:(r=e.sent).error?n({status:500,error:"خطای سرور"}):t({status:200,result:r.count+1});case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){ee(s,r,a,u,o,"next",e)}function o(e){ee(s,r,a,u,o,"throw",e)}u(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())};function ne(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function re(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){ne(s,r,a,u,o,"next",e)}function o(e){ne(s,r,a,u,o,"throw",e)}u(void 0)}))}}function ae(e){return se.apply(this,arguments)}function se(){return(se=re(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("::::::::::",t),e.abrupt("return",new Promise(function(){var e=re(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.db.query("\n        FOR pregnancy, edge IN OUTBOUND 'animals/".concat(t,"' animalEdges\n        FILTER edge.value == 'pregnancy'\n        FOR animal IN INBOUND pregnancy._id animalEdges\n        FILTER animal.sex == 0\n        SORT DATE_TIMESTAMP(pregnancy.startedAt) DESC\n        RETURN {pregnancy, male: animal}\n        "));case 3:a=e.sent,console.log(a._result),n(a._result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function oe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){ue(s,r,a,u,o,"next",e)}function o(e){ue(s,r,a,u,o,"throw",e)}u(void 0)}))}}function ce(e){return ie.apply(this,arguments)}function ie(){return(ie=oe(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=oe(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.db.query("\n        FOR vaccine, edge IN OUTBOUND 'animals/".concat(t,"' animalEdges\n        FILTER edge.value == 'vaccine'\n        Filter vaccine.deleted != true\n        return vaccine\n        "));case 3:a=e.sent,console.log(a._result),n(a._result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=Object(r.Router)();le.get("/newKey",(function(e,t){te().then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.get("/stock/:limit/:animalKey/:sex/:type/:race",(function(e,t){X(e.params.limit,e.params.animalKey,e.params.sex,e.params.type,e.params.race).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.get("/stock/:limit/:animalKey",(function(e,t){X(e.params.limit,e.params.animalKey).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.get("/detail/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=Q(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z(n);case 3:a=e.sent,t({status:200,details:a}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({details:e.details})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.get("/pregnancy/:key",(function(e,t){var n;console.log("ppppppppppppppppppppppp"),(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=re(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ae(n);case 3:a=e.sent,console.log("result is :: ",a),t({status:200,result:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.post("/new",(function(e,t){var n;(n=e.body,console.log("...............................................",n),new Promise(function(){var e=K(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,e.next=6,B(a);case 6:return s=e.sent,e.next=9,p.Animals.documentExists("".concat(n.animal.key));case 9:if(!0!==e.sent){e.next=12;break}throw{status:401,error:"دامی با پلاک مشابه در دیتابیس ثبت شده است"};case 12:return e.next=14,j(n.animal,a);case 14:return u=e.sent,e.next=17,p.db.beginTransaction({write:["logs","animals","weights","expenses","animalEdges"]});case 17:return o=e.sent,e.next=20,o.run((function(){return p.Animals.save(u)}));case 20:return c=e.sent,e.next=23,o.run((function(){return p.Weights.save({value:"number"==typeof n.animal.weight?n.animal.weight:Number(n.animal.weight),createdAt:Date.now(),date:n.animal.entryDate})}));case 23:return i=e.sent,e.next=26,o.run((function(){return p.AnimalEdges.save({value:"weight",_from:c._id,_to:i._id})}));case 26:return e.next=28,o.run((function(){return p.Logs.save({value:"create",type:"animal",entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 28:return e.next=30,o.run((function(){return p.Logs.save({value:"create",type:"weight",entryId:i._id,userId:s._id,createdAt:Date.now()})}));case 30:if(1!==n.animal.entryType){e.next=38;break}return e.next=33,o.run((function(){return p.Expenses.save({value:"number"==typeof n.animal.price?n.animal.price:Number(n.animal.price),createdAt:Date.now(),date:n.animal.entryDate,type:"buy-animal"})}));case 33:return l=e.sent,e.next=36,o.run((function(){return p.AnimalEdges.save({value:"expense",_from:c._id,_to:l._id})}));case 36:return e.next=38,o.run((function(){return p.Logs.save({value:"create",type:"expense",entryId:l._id,userId:s._id,createdAt:Date.now()})}));case 38:return e.next=40,o.commit();case 40:t({status:200,result:"دام با موفقیت ایجاد شد"}),e.next=47;break;case 43:e.prev=43,e.t0=e.catch(0),console.log(e.t0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 47:case"end":return e.stop()}}),e,null,[[0,43]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.get("/vaccine/:key",(function(e,t){var n;(n=e.params.key,console.log("get details :: ",n),new Promise(function(){var e=oe(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ce(n);case 3:a=e.sent,console.log("result is :: ",a),t({status:200,result:a}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),le.get("/total",(function(e,t){new Promise((function(e,t){try{p.db.query("\n        FOR animal IN animals\n        FILTER animal.deleted != true\n        FILTER animal.exit != true\n        COLLECT WITH COUNT INTO length\n        RETURN length\n        ").then((function(t){var n=t._result;e({status:200,result:n})})).catch((function(e){throw new Error({status:500,error:"خطای سرور"})}))}catch(e){e.status?t(e):t({status:500,error:"خطای سرور"})}})).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var fe=le;function de(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}var pe=function(e,t){return new Promise(function(){var n,r=(n=regeneratorRuntime.mark((function n(r,a){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{p.db.query("\n        FOR log IN logs\n        SORT DATE_TIMESTAMP(log.createdAt) DESC\n        LIMIT ".concat(Number(t)*Number(e),", ").concat(Number(t+1)*Number(e),"\n        return log\n        ")).then((function(e){console.log(e._result),r({status:200,result:e._result})}))}catch(e){console.log(e),a({status:500,msg:"خطای سرور"})}case 1:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,a){var s=n.apply(e,t);function u(e){de(s,r,a,u,o,"next",e)}function o(e){de(s,r,a,u,o,"throw",e)}u(void 0)}))});return function(e,t){return r.apply(this,arguments)}}())},me=Object(r.Router)();me.get("/pagination/:limit/:page",(function(e,t){pe(e.params.limit,e.params.page).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var ve=me;function ge(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ye(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){ge(s,r,a,u,o,"next",e)}function o(e){ge(s,r,a,u,o,"throw",e)}u(void 0)}))}}var xe=function(e){return new Promise(function(){var t=ye(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:"دامی با این پلاک وجود ندارد"});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function he(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function we(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){he(s,r,a,u,o,"next",e)}function o(e){he(s,r,a,u,o,"throw",e)}u(void 0)}))}}function Re(e){return ke.apply(this,arguments)}function ke(){return(ke=we(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var be=function(e){return new Promise((function(t,n){t("\n    FOR weight, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'weight'\n    FILTER weight.deleted != true\n    RETURN weight\n    ")),n()}))};function Ee(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function _e(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Ee(s,r,a,u,o,"next",e)}function o(e){Ee(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Pe=function(e){return new Promise(function(){var t=_e(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Te(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ie(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Te(s,r,a,u,o,"next",e)}function o(e){Te(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Ae=function(e){return new Promise(function(){var t=Ie(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},De=Object(r.Router)();De.get("/:animalKey",(function(e,t){var n;(n=e.params.animalKey,new Promise(function(){var e=we(regeneratorRuntime.mark((function e(t,r){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,be(n);case 3:return a=e.sent,e.next=6,Re(a);case 6:s=e.sent,t({status:200,result:s}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),De.post("/new",(function(e,t){var n;(n=e.body,console.log("================================",n),new Promise(function(){var e=ye(regeneratorRuntime.mark((function e(t,r){var a,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,e.next=6,xe(a);case 6:return s=e.sent,e.next=9,p.Animals.documentExists("".concat(n.entry.key));case 9:return e.sent||r({status:400,error:x}),e.next=13,p.Animals.document(n.entry.key);case 13:if(!0!==e.sent.out){e.next=16;break}throw{status:401,error:animalIsOut};case 16:return e.next=18,p.db.beginTransaction({write:["logs","animals","weights","animalEdges"]});case 18:return u=e.sent,e.next=21,u.run((function(){return p.Weights.save({value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),createdAt:Date.now(),date:n.entry.date})}));case 21:return o=e.sent,e.next=24,u.run((function(){return p.AnimalEdges.save({value:"weight",_from:"animals/".concat(n.entry.key),_to:o._id})}));case 24:return e.next=26,u.run((function(){return p.Logs.save({value:"create",type:"weight",entryId:o._id,userId:s._id,createdAt:Date.now()})}));case 26:return e.next=28,u.commit();case 28:t({status:200,result:h}),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 36:case"end":return e.stop()}}),e,null,[[0,31]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),De.delete("/:token/:key",(function(e,t){var n,r;console.log("reeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeemove"),(n=e.params.token,r=e.params.key,new Promise(function(){var e=_e(regeneratorRuntime.mark((function e(t,a){var s,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n,v);case 3:return s=e.sent,console.log(s),e.next=7,Pe(s);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({read:["weights"],write:["logs","weights"]});case 10:return o=e.sent,e.next=13,o.run((function(){return p.Weights.document(r)}));case 13:return c=e.sent,e.next=16,o.run((function(){return p.Weights.update(c,{deleted:!0,deleteDate:Date.now()})}));case 16:return e.next=18,o.run((function(){return p.Logs.save({value:"delete",type:"weight",entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 18:return e.next=20,o.commit();case 20:t({status:200,result:h}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&a(e.t0),a({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),De.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=Ie(regeneratorRuntime.mark((function e(t,r){var a,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,console.log(a),e.next=7,Ae(a);case 7:return s=e.sent,e.next=10,p.db.beginTransaction({write:["logs","weights"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.Weights.document(n.entry.key)}));case 13:return o=e.sent,console.log("weight is :: ",o),e.next=17,u.run((function(){return p.Logs.save({value:"update",type:"weight",entryId:o._id,userId:s._id,form:{date:o.date,value:o.value},to:{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date},createdAt:Date.now()})}));case 17:return e.next=19,u.run((function(){return p.Weights.update(o,{value:"number"==typeof n.entry.value?n.entry.value:Number(n.entry.value),date:n.entry.date,updatedAt:n.entry.updatedAt})}));case 19:return e.next=21,u.commit();case 21:t({status:200,result:h}),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 29:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var Fe=De;function Oe(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ne(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Oe(s,r,a,u,o,"next",e)}function o(e){Oe(s,r,a,u,o,"throw",e)}u(void 0)}))}}function Ce(e){return Le.apply(this,arguments)}function Le(){return(Le=Ne(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;r.length?e(r):n({status:404,error:w})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ue=function(e,t){return new Promise((function(n,r){n("FOR expense IN expenses\n    FILTER expense.deleted != true\n    FILTER DATE_TIMESTAMP(expense.createdAt) >= DATE_TIMESTAMP('".concat(e,"') && DATE_TIMESTAMP(expense.createdAt) <= DATE_TIMESTAMP('").concat(t,"')\n    COLLECT AGGREGATE v = SUM(expense.value)\n    RETURN v")),r()}))},Se=Object(r.Router)();Se.get("/:from/:to",(function(e,t){var n,r;(n=e.params.from,r=e.params.to,new Promise(function(){var e=Ne(regeneratorRuntime.mark((function e(t,a){var s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(n,r);case 2:return s=e.sent,console.log("........",s),e.prev=4,e.next=7,Ce(s);case 7:u=e.sent,console.log("..........",u),t({status:200,result:u}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),e.t0.status?a(e.t0):a({status:500,msg:"خطای سرور"});case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var qe=Se;function Me(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ke(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Me(s,r,a,u,o,"next",e)}function o(e){Me(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Be=function(e){return new Promise(function(){var t=Ke(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function je(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ve(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){je(s,r,a,u,o,"next",e)}function o(e){je(s,r,a,u,o,"throw",e)}u(void 0)}))}}function We(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=Ve(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var He=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR vaccine IN 1..1 OUTBOUND animal fromAnimalToVaccine\n    FILTER vaccine.deleted != true\n    SORT DATE_TIMESTAMP(vaccine.createdAt) ASC\n    RETURN {vaccine}\n    ")),n()}))};function Ye(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ze(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Ye(s,r,a,u,o,"next",e)}function o(e){Ye(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Xe=function(e){return new Promise(function(){var t=ze(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Je(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Qe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Je(s,r,a,u,o,"next",e)}function o(e){Je(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Ze=function(e){return new Promise(function(){var t=Qe(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},$e=Object(r.Router)();$e.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.keys,console.log("got the req, ".concat(r)),new Promise(function(){var e=Ve(regeneratorRuntime.mark((function e(t,n){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==r.length){e.next=14;break}return e.prev=1,e.next=4,He(r[0]);case 4:return a=e.sent,e.next=7,We(a);case 7:s=e.sent,t({status:200,result:s}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),$e.post("/",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=Ke(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,console.log(a),e.next=7,Be(a);case 7:return s=e.sent,e.next=10,p.Animals.documentExists("".concat(n.entry.key));case 10:if(u=e.sent,console.log("****&&&^^^",u),u){e.next=14;break}throw{status:400,error:x};case 14:return e.next=16,p.db.beginTransaction({read:["animals"],write:["vaccines","animals","animalEdges","logs"]});case 16:return o=e.sent,e.next=19,p.Animals.document(n.entry.key);case 19:if(!0!==(c=e.sent).out){e.next=22;break}throw{status:401,error:k};case 22:return console.log("animal is ::: ",c),e.next=25,o.run((function(){return p.Vaccines.save({value:n.entry.vaccine,date:n.entry.date,createdAt:Date.now()})}));case 25:return i=e.sent,e.next=28,o.run((function(){return p.AnimalEdges.save({value:"vaccine",_from:c._id,_to:i._id})}));case 28:return e.next=30,o.run((function(){return p.Logs.save({value:"create",type:"vaccine",entryId:i._id,userId:s._id,createdAt:Date.now()})}));case 30:return e.next=32,o.commit();case 32:t({status:200,result:h}),e.next=40;break;case 35:e.prev=35,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 40:case"end":return e.stop()}}),e,null,[[0,35]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),$e.delete("/:token/:key",(function(e,t){var n,r;(n=e.params.token,r=e.params.key,new Promise(function(){var e=ze(regeneratorRuntime.mark((function e(t,a){var s,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n,v);case 3:return s=e.sent,console.log(s),e.next=7,Xe(s);case 7:return u=e.sent,e.next=10,p.db.beginTransaction({write:["animals","logs","vaccines"]});case 10:return o=e.sent,e.next=13,o.run((function(){return p.Vaccines.document(r)}));case 13:return c=e.sent,e.next=16,o.run((function(){return p.Vaccines.update(c,{deleted:!0})}));case 16:return e.next=18,o.run((function(){return p.Logs.save({value:"delete",type:"vaccine",entryId:c._id,userId:u._id,createdAt:Date.now()})}));case 18:return e.next=20,o.commit();case 20:t({status:200,result:h}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&a(e.t0),a({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),$e.put("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=Qe(regeneratorRuntime.mark((function e(t,r){var a,s,u,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,console.log(a),e.next=7,Ze(a);case 7:return s=e.sent,e.next=10,p.db.beginTransaction({write:["logs","vaccines"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.Vaccines.document(n.entry.key)}));case 13:return o=e.sent,e.next=16,u.run((function(){return p.Logs.save({value:"update",type:"vaccine",entryId:o._id,userId:s._id,form:{date:o.date,value:o.value,updatedAt:o.updatedAt},to:{value:n.entry.value,date:n.entry.date,updatedAt:n.entry.updatedAt},createdAt:Date.now()})}));case 16:return e.next=18,u.run((function(){return p.Vaccines.update(o,{value:n.entry.value,date:n.entry.date,updatedAt:n.entry.updatedAt})}));case 18:return e.next=20,u.commit();case 20:t({status:200,result:h}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var et=$e;n(4);function tt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function nt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){tt(s,r,a,u,o,"next",e)}function o(e){tt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var rt=function(e){return new Promise(function(){var t=nt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function at(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function st(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){at(s,r,a,u,o,"next",e)}function o(e){at(s,r,a,u,o,"throw",e)}u(void 0)}))}}var ut=function(e){return new Promise(function(){var t=st(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function ot(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ct(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){ot(s,r,a,u,o,"next",e)}function o(e){ot(s,r,a,u,o,"throw",e)}u(void 0)}))}}var it=function(e){return new Promise(function(){var t=ct(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function lt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function ft(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){lt(s,r,a,u,o,"next",e)}function o(e){lt(s,r,a,u,o,"throw",e)}u(void 0)}))}}function dt(e){return pt.apply(this,arguments)}function pt(){return(pt=ft(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;e(r),n()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var mt=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'exit'\n    Filter vertex.deleted != true\n    return vertex\n    ")),n()}))},vt=Object(r.Router)();vt.get("/:animalKey",(function(e,t){var n;(n=e.params.animalKey,new Promise(function(){var e=ft(regeneratorRuntime.mark((function e(t,r){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,mt(n);case 3:return a=e.sent,e.next=6,dt(a);case 6:s=e.sent,console.log("result is ::: ",s),t({status:200,result:s[0]}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),vt.post("/sell",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=st(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,e.next=6,ut(a);case 6:return s=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["animals","exits","incomes","animalEdges","logs"]});case 9:return u=e.sent,e.next=12,u.run((function(){return p.Animals.document(n.entry.key)}));case 12:if(!(o=e.sent).exit){e.next=15;break}throw{status:400,error:"امکان ثبت فروش برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 15:return e.next=17,u.run((function(){return p.Animals.update(o,{exit:!0})}));case 17:return e.next=19,u.run((function(){return p.Exits.save({type:"sell",date:n.entry.date,comment:n.entry.comment,createdAt:Date.now()})}));case 19:return c=e.sent,e.next=22,u.run((function(){return p.Incomes.save({type:"sell",date:n.entry.date,price:"number"==typeof n.entry.price?n.entry.price:Number(n.entry.price),createdAt:Date.now()})}));case 22:return i=e.sent,e.next=25,u.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:i._id})}));case 25:return e.next=27,u.run((function(){return p.AnimalEdges.save({value:"income",_from:o._id,_to:c._id})}));case 27:return e.next=29,u.run((function(){return p.Logs.save({value:"create",type:"exit",entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 29:return e.next=31,u.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 31:return e.next=33,u.run((function(){return p.Logs.save({value:"create",type:"income",entryId:i._id,userId:s._id,createdAt:Date.now()})}));case 33:return e.next=35,u.commit();case 35:t({status:200,result:h}),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 43:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),vt.post("/slaughter",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=ct(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,e.next=6,it(a);case 6:return s=e.sent,e.next=9,p.db.beginTransaction({write:["animals","exits","animalEdges","weights","logs"]});case 9:return u=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!(o=e.sent).exit){e.next=16;break}throw console.log("animal is out"),{status:400,error:"امکان ثبت ذبح برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 16:return e.next=18,u.run((function(){return p.Animals.update(o,{exit:!0})}));case 18:return e.next=20,u.run((function(){return p.Exits.save({type:"slaughter",date:n.entry.date,createdAt:Date.now()})}));case 20:return c=e.sent,e.next=23,u.run((function(){return p.Weights.save({value:"number"==typeof n.entry.weight?n.entry.weight:Number(n.entry.weight),createdAt:Date.now(),date:n.entry.date})}));case 23:return i=e.sent,e.next=26,u.run((function(){return p.AnimalEdges.save({value:"weight",_from:o._id,_to:i._id})}));case 26:return e.next=28,u.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:c._id})}));case 28:return e.next=30,u.run((function(){return p.Logs.save({value:"create",type:"exit",entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 30:return e.next=32,u.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 32:return e.next=34,u.run((function(){return p.Logs.save({value:"create",type:"weight",entryId:i._id,userId:s._id,createdAt:Date.now()})}));case 34:return e.next=36,u.commit();case 36:t({status:200,result:h}),e.next=44;break;case 39:e.prev=39,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 44:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({msg:e.msg})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),vt.post("/death",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=nt(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,e.next=6,rt(a);case 6:return s=e.sent,e.next=9,p.db.beginTransaction({write:["animals","exits","animalEdges","diseases","diseaseSteps","exitEdges","diseaseEdges","logs"]});case 9:return u=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!(o=e.sent).out){e.next=16;break}throw console.log("**************"),{status:400,error:"امکان ثبت مرگ برای دامی که از لیست دام های موجود خارج شده است وجود  ندارد"};case 16:return e.next=18,u.run((function(){return p.Animals.update(o,{exit:!0})}));case 18:return e.next=20,u.run((function(){return p.Exits.save({type:"death",reason:n.entry.reason,disease:"بیماری"===n.entry.reason?n.entry.disease.value:void 0,date:n.entry.date,createdAt:Date.now(),comment:n.entry.comment})}));case 20:return c=e.sent,e.next=23,u.run((function(){return p.AnimalEdges.save({value:"exit",_from:o._id,_to:c._id})}));case 23:return e.next=25,u.run((function(){return p.db.query("\n          FOR vertex, edge IN OUTBOUND 'animals/".concat(n.entry.key,"' animalEdges\n          FILTER edge.value == 'disease'\n          FILTER vertex.deleted != true\n          FILTER vertex.active == true\n          RETURN vertex\n          "))}));case 25:return e.sent._result.forEach(function(){var e=nt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.run((function(){return p.Diseases.update(t,{active:!1})}));case 2:return e.next=4,u.run((function(){return p.Logs.save({value:"update",type:"disease",from:{active:!0},to:{active:!1},entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=29,u.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:o.exit},to:{exit:!0},entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 29:return e.next=31,u.run((function(){return p.Logs.save({value:"create",type:"exit",entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 31:if("بیماری"!==n.entry.reason){e.next=40;break}return console.log("##############################################################"),e.next=35,u.run((function(){return p.DiseaseSteps.save({drugs:n.entry.drugs,effects:n.entry.effects,treatment:n.entry.treatment,comment:n.entry.comment,isCured:n.entry.isCured,date:n.entry.date,createdAt:Date.now(),died:!0})}));case 35:return i=e.sent,e.next=38,u.run((function(){return p.DiseaseEdges.save({value:"step",_from:n.entry.disease._id,_to:i._id})}));case 38:return e.next=40,u.run((function(){return p.ExitEdges.save({value:"disease",_from:c._id,_to:n.entry.disease._id})}));case 40:return e.next=42,u.commit();case 42:t({status:200,result:h}),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 50:case"end":return e.stop()}}),e,null,[[0,45]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var gt=vt;function yt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function xt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){yt(s,r,a,u,o,"next",e)}function o(e){yt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var ht=function(e){return new Promise(function(){var t=xt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function wt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Rt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){wt(s,r,a,u,o,"next",e)}function o(e){wt(s,r,a,u,o,"throw",e)}u(void 0)}))}}function kt(e){return bt.apply(this,arguments)}function bt(){return(bt=Rt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var r=t._result;e(r),n()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Et=function(e){return new Promise((function(t,n){t("\n    FOR animal IN animals\n    FILTER animal._key == '".concat(e,"'\n    FOR pregnancy IN 1..1 OUTBOUND animal fromAnimalToPregnancy\n    FOR male IN 1..1 INBOUND pregnancy fromAnimalToPregnancy\n    FILTER pregnancy.deleted == false\n    FILTER male.sex == 0\n    SORT DATE_TIMESTAMP(pregnancy.startedAt) ASC\n    RETURN {pregnancy, male}\n    ")),n()}))};function _t(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Pt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){_t(s,r,a,u,o,"next",e)}function o(e){_t(s,r,a,u,o,"throw",e)}u(void 0)}))}}function Tt(e){return It.apply(this,arguments)}function It(){return(It=Pt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){console.log("***************",t);var r=t._result;r.length?e(r):n({status:404,error:w})}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var At=function(e){return new Promise((function(t,n){t("\n    FOR edge IN pregnancy\n    FILTER edge._key == '".concat(e,"'\n    FOR parent IN 1..1 INBOUND edge fromAnimalToPregnancy\n    RETURN {parent}\n    ")),n()}))};function Dt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ft(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Dt(s,r,a,u,o,"next",e)}function o(e){Dt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Ot=function(e){return new Promise(function(){var t=Ft(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.userCollection.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},Nt=Object(r.Router)();Nt.post("/new",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=xt(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,console.log(a),e.next=7,ht(a);case 7:return s=e.sent,e.next=10,p.Animals.documentExists(n.entry.maleKey);case 10:if(e.sent){e.next=13;break}throw{status:400,error:x};case 13:return e.next=15,p.Animals.documentExists(n.entry.femaleKey);case 15:if(e.sent){e.next=18;break}throw{status:400,error:x};case 18:return e.next=20,p.db.beginTransaction({read:["animals"],write:["animals","logs","pregnancies","animalEdges"]});case 20:return u=e.sent,o={startedAt:n.entry.date,createdAt:Date.now(),active:!0},n.entry.note&&(o.notes=[n.entry.note]),e.next=25,u.run((function(){return p.Pregnancies.save(o)}));case 25:return c=e.sent,console.log("ppppppppppppppp is : ",c),e.next=29,p.Animals.document(n.entry.maleKey);case 29:return i=e.sent,e.next=32,p.Animals.document(n.entry.femaleKey);case 32:if(!0!==(l=e.sent).pregnant){e.next=35;break}throw{status:401,error:"امکان ثبت بارداری برای دام ماده ای که باردار است وجود ندارد"};case 35:return e.next=37,u.run((function(){return p.Animals.update(l,{pregnant:!0})}));case 37:return e.next=39,u.run((function(){return p.AnimalEdges.save({value:"pregnancy",sex:"0",_from:i._id,_to:c._id})}));case 39:return e.next=41,u.run((function(){return p.AnimalEdges.save({value:"pregnancy",sex:"1",_from:l._id,_to:c._id})}));case 41:return e.next=43,u.run((function(){return p.Logs.save({value:"create",type:"pregnancy",entryId:c._id,userId:s._id,createdAt:Date.now()})}));case 43:return e.next=45,u.commit();case 45:t({status:200,result:h}),e.next=53;break;case 48:e.prev=48,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 53:case"end":return e.stop()}}),e,null,[[0,48]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Nt.post("/read",(function(e,t){var n,r;(n=e.body,r=n.entry.key,new Promise(function(){var e=Rt(regeneratorRuntime.mark((function e(t,n){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Et(r);case 3:return a=e.sent,e.next=6,kt(a);case 6:s=e.sent,console.log("result is ::: ",s),t({status:200,result:s}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Nt.post("/readDetails",(function(e,t){var n,r;(n=e.body,r=n.entry.key,new Promise(function(){var e=Pt(regeneratorRuntime.mark((function e(t,n){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,At(r);case 3:return a=e.sent,e.next=6,Tt(a);case 6:s=e.sent,console.log("result is ::: ",s),t({status:200,result:s}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?n(e.t0):n({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Nt.post("/remove",(function(e,t){var n;(n=e.body,console.log(n),new Promise(function(){var e=Ft(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,console.log(a),e.next=7,Ot(a);case 7:return s=e.sent,e.next=10,p.db.beginTransaction({read:["animals","fromAnimalToPregnancy"],write:["animals","logs","pregnancy","fromAnimalToPregnancy"]});case 10:return u=e.sent,e.next=13,u.run((function(){return p.pregnancyCollection.document(n.entry.key)}));case 13:return o=e.sent,e.next=16,u.run((function(){return p.animalCollection.document(n.entry.femaleKey)}));case 16:return c=e.sent,e.next=19,p.db.query("\n        FOR v, e IN INBOUND 'pregnancy/".concat(n.entry.key,"' fromAnimalToPregnancy\n        RETURN e\n          "));case 19:return i=e.sent,console.log(i._result),i._result.forEach(function(){var e=Ft(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.run((function(){return p.fromAnimalToPregnancy.update(t,{deleted:!0})}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=24,u.run((function(){return p.pregnancyCollection.update(o,{deleted:!0})}));case 24:if(o.finishedAt){e.next=27;break}return e.next=27,u.run((function(){return p.animalCollection.update(c,{pregnant:!1})}));case 27:return e.next=29,u.run((function(){return p.logCollection.save({mode:"remove",type:"pregnancy",enetryKey:o._key,userKey:s._key})}));case 29:return e.next=31,u.commit();case 31:t({status:200,result:h}),e.next=39;break;case 34:e.prev=34,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 39:case"end":return e.stop()}}),e,null,[[0,34]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),Nt.get("/getActive/:animalKey",(function(e,t){console.log("??????????????????",e.params.animalKey)}));var Ct=Nt;function Lt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Ut(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Lt(s,r,a,u,o,"next",e)}function o(e){Lt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var St=function(e){return new Promise(function(){var t=Ut(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function qt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Mt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){qt(s,r,a,u,o,"next",e)}function o(e){qt(s,r,a,u,o,"throw",e)}u(void 0)}))}}function Kt(e){return Bt.apply(this,arguments)}function Bt(){return(Bt=Mt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var jt=function(e){return console.log({key:e}),new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'disease'\n    Filter vertex.deleted != true\n    return vertex\n    ")),n()}))};function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Gt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Wt(s,r,a,u,o,"next",e)}function o(e){Wt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Ht=function(e){return new Promise(function(){var t=Gt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function Yt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function zt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Yt(s,r,a,u,o,"next",e)}function o(e){Yt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var Xt=function(e){return new Promise(function(){var t=zt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?("admin"!==a.role&&r({status:401,error:R}),n(a)):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},Jt=function(e){return new Promise(function(){var t=zt(regeneratorRuntime.mark((function t(n,r){var a,s,u,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,P.a.verify(e.token,v);case 3:return a=t.sent,console.log(a),t.next=7,Xt(a);case 7:return s=t.sent,t.next=10,p.db.beginTransaction({read:["diseases"],write:["logs","diseases"]});case 10:return u=t.sent,t.next=13,u.run((function(){return p.Diseases.document(e.entry.key)}));case 13:return o=t.sent,console.log("disease is :: ",o),t.next=17,u.run((function(){return p.Logs.save({value:"update",type:"disease",entryId:o._id,userId:s._id,form:{value:o.value,date:o.date,updatedAt:o.updatedAt,comment:o.comment},to:{value:e.entry.value[0],date:e.entry.date,updatedAt:e.entry.updatedAt,comment:e.entry.comment},createdAt:Date.now()})}));case 17:return t.next=19,u.run((function(){return p.Diseases.update(o,{value:e.entry.value[0],date:e.entry.date,updatedAt:e.entry.updatedAt,comment:e.entry.comment})}));case 19:return t.next=21,u.commit();case 21:n({status:200,result:h}),t.next=29;break;case 24:t.prev=24,t.t0=t.catch(0),console.log(t.t0),t.t0.status&&r(t.t0),r({status:500,error:"خطای سرور"});case 29:case"end":return t.stop()}}),t,null,[[0,24]])})));return function(e,n){return t.apply(this,arguments)}}())};function Qt(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function Zt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){Qt(s,r,a,u,o,"next",e)}function o(e){Qt(s,r,a,u,o,"throw",e)}u(void 0)}))}}var $t=function(e){return new Promise(function(){var t=Zt(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.Users.document(e.key);case 2:(a=t.sent)?n(a):r({status:400,error:g});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())};function en(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function tn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){en(s,r,a,u,o,"next",e)}function o(e){en(s,r,a,u,o,"throw",e)}u(void 0)}))}}function nn(e){return rn.apply(this,arguments)}function rn(){return(rn=tn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){console.log("resukt is :: ",{docs:t});var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var an=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'diseases/".concat(e,"' diseaseEdges\n    FILTER edge.value == 'step'\n    Filter vertex.deleted != true\n    SORT DATE_TIMESTAMP(vertex.date) DESC\n    return vertex\n    ")),n()}))};function sn(e,t,n,r,a,s,u){try{var o=e[s](u),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,a)}function un(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function u(e){sn(s,r,a,u,o,"next",e)}function o(e){sn(s,r,a,u,o,"throw",e)}u(void 0)}))}}function on(e){return cn.apply(this,arguments)}function cn(){return(cn=un(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){p.db.query(t).then((function(t){var n=t._result;e(n)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ln=function(e){return new Promise((function(t,n){t("\n    FOR vertex, edge IN OUTBOUND 'animals/".concat(e,"' animalEdges\n    FILTER edge.value == 'disease'\n    FILTER vertex.deleted != true\n    FILTER vertex.active == true\n    SORT DATE_TIMESTAMP(vertex.date) ASC\n    RETURN vertex\n    ")),n()}))},fn=Object(r.Router)();fn.put("/update",(function(e,t){console.log(e.body),Jt(e.body).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.post("/",(function(e,t){var n;(n=e.body,new Promise(function(){var e=Ut(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,e.next=6,St(a);case 6:return s=e.sent,e.next=9,p.db.beginTransaction({read:["animals"],write:["diseases","animals","animalEdges","logs"]});case 9:return u=e.sent,e.next=12,p.Animals.document(n.entry.key);case 12:if(!0!==(o=e.sent).out){e.next=15;break}throw{status:401,error:k};case 15:return e.next=17,u.run((function(){return p.Diseases.save({value:n.entry.value[0],date:n.entry.date,createdAt:Date.now(),comment:n.entry.comment,active:!0})}));case 17:return c=e.sent,e.next=20,u.run((function(){return p.AnimalEdges.save({value:"disease",_from:"animals/".concat(n.entry.key),_to:c._id})}));case 20:return e.next=22,u.run((function(){return p.Logs.save({value:"create",type:"disease",entryId:o._id,userId:s._id,createdAt:Date.now()})}));case 22:return e.next=24,u.commit();case 24:t({status:200,result:h}),e.next=32;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 32:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.get("/:key",(function(e,t){var n;(n=e.params.key,new Promise(function(){var e=Mt(regeneratorRuntime.mark((function e(t,r){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jt(n);case 3:return a=e.sent,e.next=6,Kt(a);case 6:s=e.sent,t({status:200,result:s}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.delete("/:token/:key/:animalKey/:confirmToDeleteOut",(function(e,t){var n,r,a,s;(n=e.params.token,r=e.params.key,a=e.params.animalKey,s=e.params.confirmToDeleteOut,console.log("kkkkkkkkkkk",{key:r}),new Promise(function(){var e=Gt(regeneratorRuntime.mark((function e(t,u){var o,c,i,l,f,d,m,g,y,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n,v);case 3:return o=e.sent,e.next=6,Ht(o);case 6:return c=e.sent,e.next=9,p.db.beginTransaction({read:["animals","animalEdges","diseaseSteps","exitEdges","exits"],write:["exits","animals","logs","diseases","animalEdges","diseaseSteps","diseaseEdges","exitEdges"]});case 9:return i=e.sent,e.next=12,p.db.query("\n        FOR v, e IN INBOUND 'diseases/".concat(r,"' exitEdges\n        FILTER v.deleted != true\n        RETURN v\n        "));case 12:if(l=e.sent,console.log("___--___--",l._result),console.log({confirmToDeleteOut:Vt(s)}),!l._result.length||"false"!==s){e.next=20;break}throw console.log("----------------------------------------------------"),{status:403,error:"پاک کردن این بیماری منجر به پاک شدن اطلاعات مرتبط با خروج دام میشود. آیا میخواهید ادامه دهید؟"};case 20:if(!l._result.length||"true"!==s){e.next=50;break}return e.next=23,i.run((function(){return p.Animals.document(a)}));case 23:return f=e.sent,e.next=26,i.run((function(){return p.Animals.update(f,{exit:!1})}));case 26:return console.log({animal:f}),e.next=29,p.db.query("\n        FOR v, e IN OUTBOUND 'diseases/".concat(r,"' diseaseEdges\n        FILTER e.value == 'step'\n        FILTER v.deleted != true\n        RETURN v\n        "));case 29:return d=e.sent,console.log({animalSteps:d}),e.next=33,i.run((function(){return p.Diseases.document(r)}));case 33:return m=e.sent,e.next=36,i.run((function(){return p.Diseases.update(m,{deleted:!0})}));case 36:return d._result.forEach(function(){var e=Gt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({step:t}),e.next=3,i.run((function(){return p.DiseaseSteps.update(t,{deleted:!0})}));case 3:return e.next=5,i.run((function(){return p.Logs.save({value:"delete",type:"diseaseSteps",entryId:t._id,userId:c._id,createdAt:Date.now()})}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=39,i.run((function(){return p.Logs.save({value:"delete",type:"disease",entryId:m._id,userId:c._id,createdAt:Date.now()})}));case 39:return e.next=41,i.run((function(){return p.db.query("\n            FOR v, e IN INBOUND 'diseases/".concat(r,"' exitEdges\n              FILTER v.deleted != true\n              return v\n          "))}));case 41:return g=e.sent,e.next=44,i.run((function(){return p.Exits.update(g._result[0],{deleted:!0})}));case 44:return e.next=46,i.run((function(){return p.Logs.save({value:"update",type:"animal",from:{exit:!0},to:{exit:!1},entryId:f._id,userId:c._id,createdAt:Date.now()})}));case 46:return e.next=48,i.run((function(){return p.Logs.save({value:"delete",type:"exit",entryId:g._id,userId:c._id,createdAt:Date.now()})}));case 48:e.next=61;break;case 50:return e.next=52,p.db.query("\n        FOR v, e IN OUTBOUND 'diseases/".concat(r,"' diseaseEdges\n        FILTER e.value == 'step'\n        FILTER v.deleted != true\n        RETURN v\n        "));case 52:return y=e.sent,e.next=55,i.run((function(){return p.Diseases.document(r)}));case 55:return x=e.sent,e.next=58,i.run((function(){return p.Diseases.update(x,{deleted:!0})}));case 58:return y._result.forEach(function(){var e=Gt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log({step:t}),e.next=3,i.run((function(){return p.DiseaseSteps.update(t,{deleted:!0})}));case 3:return e.next=5,i.run((function(){return p.Logs.save({value:"delete",type:"diseaseSteps",entryId:t._id,userId:c._id,createdAt:Date.now()})}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=61,i.run((function(){return p.Logs.save({value:"delete",type:"disease",entryId:x._id,userId:c._id,createdAt:Date.now()})}));case 61:return e.next=63,i.commit();case 63:t({status:200,result:h}),e.next=71;break;case 66:e.prev=66,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&u(e.t0),u({status:500,error:"خطای سرور"});case 71:case"end":return e.stop()}}),e,null,[[0,66]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.put("/",(function(e,t){console.log(e.body),Jt(e.body).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.post("/step",(function(e,t){var n;(n=e.body,console.log("---------------------------",n),new Promise(function(){var e=Zt(regeneratorRuntime.mark((function e(t,r){var a,s,u,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P.a.verify(n.token,v);case 3:return a=e.sent,console.log(a),e.next=7,$t(a);case 7:return s=e.sent,e.next=10,p.Animals.document(n.entry.animalKey);case 10:if(!0!==e.sent.out){e.next=13;break}throw{status:401,error:k};case 13:return e.next=15,p.db.beginTransaction({read:["diseases"],write:["diseases","diseaseSteps","diseaseEdges","logs"]});case 15:return u=e.sent,e.next=18,u.run((function(){return p.Diseases.document(n.entry.key)}));case 18:if(!(o=e.sent).isCured){e.next=21;break}throw{status:401,error:"امکان ثبت وضعیت جدید برای بیماری ای که فعال نیست وجود ندارد"};case 21:if(console.log("disease is :: ",o),!n.entry.isCured){e.next=25;break}return e.next=25,u.run((function(){return p.Diseases.update(o,{active:!1})}));case 25:return e.next=27,u.run((function(){return p.DiseaseSteps.save({drugs:n.entry.drugs,effects:n.entry.effects,date:n.entry.date,treatment:n.entry.treatment,comment:n.entry.comment,isCured:n.entry.isCured})}));case 27:return c=e.sent,console.log("related is ::: ",c),e.next=31,u.run((function(){return p.DiseaseEdges.save({value:"step",_from:o._id,_to:c._id})}));case 31:return e.next=33,u.run((function(){return p.Logs.save({value:"create",type:"diseaseStep",entryId:o._id,userId:s._id,createdAt:Date.now()})}));case 33:return e.next=35,u.commit();case 35:t({status:200,result:h}),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0),e.t0.status&&r(e.t0),r({status:500,error:"خطای سرور"});case 43:case"end":return e.stop()}}),e,null,[[0,38]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.get("/step/:key",(function(e,t){var n;(n=e.params.key,console.log("got the req, ".concat(n)),new Promise(function(){var e=tn(regeneratorRuntime.mark((function e(t,r){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,an(n);case 3:return a=e.sent,e.next=6,nn(a);case 6:s=e.sent,t({status:200,result:s}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))})),fn.get("/active/:animalKey",(function(e,t){var n;(n=e.params.animalKey,console.log("got the req, ".concat(n)),new Promise(function(){var e=un(regeneratorRuntime.mark((function e(t,r){var a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ln(n);case 3:return a=e.sent,console.log(a),e.next=7,on(a);case 7:s=e.sent,t({status:200,result:s}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),e.t0.status?r(e.t0):r({status:500,error:"خطای سرور"});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}())).then((function(e){return t.status(e.status).send({result:e.result})})).catch((function(e){return t.status(e.status).send({error:e.error})}))}));var dn=fn,pn=Object(r.Router)();d()("routes:v0");pn.use("/user",q),pn.use("/animal",fe),pn.use("/logs",ve),pn.use("/weight",Fe),pn.use("/expenses",qe),pn.use("/vaccine",et),pn.use("/exit",gt),pn.use("/pregnancy",Ct),pn.use("/disease",dn);var mn={v0:pn};n(0);var vn=d()("app:server"),gn=process.env.PORT||4e3,yn=a()();yn.use(l()()),yn.use(c.a.urlencoded({extended:!1})),yn.use(c.a.json()),yn.use(u()()),yn.use("/api/v0",mn.v0),yn.listen(gn,(function(){return vn("app listen to port ".concat(gn))}))}]);